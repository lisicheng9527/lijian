require('../../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["bundle/pages/bargain_progress/bargain_progress"],{"5dc0":function(n,t,i){"use strict";i.r(t);var e=i("624b"),a=i("b10b");for(var o in a)["default"].indexOf(o)<0&&function(n){i.d(t,n,(function(){return a[n]}))}(o);i("b38c");var r=i("828b"),s=Object(r["a"])(a["default"],e["b"],e["c"],!1,null,"48060d9e",null,!1,e["a"],void 0);t["default"]=s.exports},"624b":function(n,t,i){"use strict";i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){return e}));var e={navbar:function(){return Promise.all([i.e("common/vendor"),i.e("components/navbar/navbar")]).then(i.bind(null,"d060"))},uImage:function(){return i.e("components/uview-ui/components/u-image/u-image").then(i.bind(null,"0cd9"))},price:function(){return i.e("components/price/price").then(i.bind(null,"ac59"))},uCountDown:function(){return i.e("components/uview-ui/components/u-count-down/u-count-down").then(i.bind(null,"e50f"))},goodsSpec:function(){return Promise.all([i.e("common/vendor"),i.e("components/goods-spec/goods-spec")]).then(i.bind(null,"8132"))},uPopup:function(){return i.e("components/uview-ui/components/u-popup/u-popup").then(i.bind(null,"47bf"))},uIcon:function(){return i.e("components/uview-ui/components/u-icon/u-icon").then(i.bind(null,"4032"))},sharePopup:function(){return i.e("components/share-popup/share-popup").then(i.bind(null,"0584"))},pageStatus:function(){return i.e("components/page-status/page-status").then(i.bind(null,"0a8b"))},uEmpty:function(){return i.e("components/uview-ui/components/u-empty/u-empty").then(i.bind(null,"ec9f"))}},a=function(){var n=this,t=n.$createElement,i=(n._self._c,0==n.status?{image:n.bargainData.image,price:n.bargainData.goods_max_price,stock:n.bargainData.total_stock,bargain_price:n.bargainData.min_price}:null),e=4==n.status?n.bargainData.help_record.length:null,a=n.reduceAmount.toFixed(2)||0,o={goodsId:n.bargainData.goods_id,activityId:n.bargainData.activity_id},r={image:n.bargainData.goods_image,name:n.bargainData.goods_name};n._isMounted||(n.e0=function(t){n.showGoodsSpec=!1}),n.$mp.data=Object.assign({},{$root:{a0:i,g0:e,g1:a,a1:o,a2:r}})},o=[]},"865c":function(n,t,i){"use strict";(function(n,t){var e=i("47a9");i("5c7a");e(i("3240"));var a=e(i("5dc0"));n.__webpack_require_UNI_MP_PLUGIN__=i,t(a.default)}).call(this,i("3223")["default"],i("df3c")["createPage"])},"97ed":function(n,t,i){},b10b:function(n,t,i){"use strict";i.r(t);var e=i("cd93"),a=i.n(e);for(var o in e)["default"].indexOf(o)<0&&function(n){i.d(t,n,(function(){return e[n]}))}(o);t["default"]=a.a},b38c:function(n,t,i){"use strict";var e=i("97ed"),a=i.n(e);a.a},cd93:function(n,t,i){"use strict";(function(n){var e=i("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i("53f0"),o=i("3cc3"),r=i("4a52"),s=(i("d29e"),e(i("8697")),{data:function(){return{pageStatus:o.PageStatusEnum["LOADING"],activityId:0,goodsId:0,bargainData:{help_record:[]},showGoodsSpec:!1,specButtonsList:[],goodsSpecOptions:{},specButtonsGroups:{confirm:{event:"confirm",text:"确认"}},reduceAmount:0,diffPrice:0,needHelp:0,currentPrice:0,precent:0,initiateId:0,showBargainPop:!1,showSharePop:!1,status:0,nowTime:0}},computed:{specValueStr:function(){var n,t,i;return null!==(n=null===(t=this.goodsSpecOptions)||void 0===t||null===(i=t.spec)||void 0===i?void 0:i.spec_value_str)&&void 0!==n?n:""}},methods:{bargainDetail:function(){var n=this;(0,a.apiBargainDetail)({activity_id:this.activityId,goods_id:this.goodsId}).then((function(t){console.log("res",t),n.bargainData=t,n.pageStatus=o.PageStatusEnum["NORMAL"]})).catch((function(t){console.log(t,"1"),n.pageStatus=o.PageStatusEnum["ERROR"]}))},onSelect:function(){this.showGoodsSpec=!0,this.specButtonsList=[this.specButtonsGroups.confirm]},changeGoodsSpec:function(n){this.goodsSpecOptions=n,console.log(n)},handleConfirm:function(n){var t=this,i=n.spec,e=n.number;if(!this.isLogin)return this.$Router.push("/pages/login/login");(0,a.apiBargainInitiate)({activity_id:this.activityId,item_id:i.id,goods_num:e}).then((function(n){console.log("发起砍价",n),t.reduceAmount=n.reduce_amount,t.diffPrice=n.diff_price,t.initiateId=n.initiate_id,t.needHelp=n.need_help,t.bargainProgress(),(n.reduce_amount||n.need_help)&&(t.precent=100*(n.reduce_amount/n.need_help).toFixed(2),t.showBargainPop=!0)}))},bargainProgress:function(){var n=this;(0,a.apiBargainProgress)({initiate_id:this.initiateId}).then((function(t){n.bargainData=t,n.status=t.status,n.bargainData.precent=100*(t.help_total/(t.help_total+t.help_diff)).toFixed(2),n.pageStatus=o.PageStatusEnum["NORMAL"]})).catch((function(t){console.log(t,"2"),n.pageStatus=o.PageStatusEnum["ERROR"]}))},closeBargainPop:function(){this.showBargainPop=!1},shareToBargain:function(){this.showSharePop=!0},onShareAppMessage:function(){return{path:"bundle/pages/bargain_progress/bargain_progress?initiate_id="+this.initiateId+"&isShare=2&invite_code="+this.userInfo.code,title:"我正在参与砍价，还差一步",imageUrl:this.bargainData.goods_image}},bargainShareDetail:function(){var n=this;return new Promise((function(t,i){(0,a.apiBargainShareDetail)({initiate_id:n.initiateId}).then((function(i){console.log(i,"bargainShareDetail"),n.bargainData=i,t(i),n.pageStatus=o.PageStatusEnum["NORMAL"]})).catch((function(t){console.log(t),n.$Router.replace({path:"/pages/login/login"}),i(t)}))}))},goToOrder:function(){this.$Router.push({path:"/pages/order_detail/order_detail",query:{order_id:this.bargainData.order_id}})},goToConfirm:function(n){this.$Router.replace({path:"/pages/goods_order/goods_order",query:{from:o.OrderTypeEnum["BARGAIN"],payload:{initiate_id:this.initiateId,buy_condition:n}}})},onBargain:function(){var n=this;(0,a.apiBargainHelp)({initiate_id:this.initiateId}).then((function(t){console.log("发起砍价",t),n.reduceAmount=t.reduce_amount,n.currentPrice=t.current_price,n.initiateId=t.initiate_id,n.precent=100*((t.need_help-t.diff_price)/t.need_help).toFixed(2),n.$nextTick((function(){this.showBargainPop=!0})),n.bargainShareDetail()}))},onGoodsBargain:function(){n.navigateTo({url:"/bundle/pages/goods_bargain/goods_bargain"})}},onLoad:function(){var n=this,t=new Date;this.nowTime=Date.parse(t)/1e3,console.log("nowTime",this.nowTime);var i=this.$Route.query;console.log(i,"------");var e=i["scene"],a=null===i||void 0===i?void 0:i.id;if(console.log("scene",e),e||a)this.initiateId=e?(0,r.strToParams)(decodeURIComponent(e))["id"]:a,console.log("initiateId",this.initiateId),this.status=4,this.bargainShareDetail().then((function(t){n.bargainData.user_id==n.userInfo.id&&n.bargainProgress()}));else{if(i.goods_id&&(this.goodsId=i.goods_id),i.activity_id)return this.activityId=i.activity_id,void setTimeout((function(){n.bargainDetail()}),50);2==i.isShare?(this.status=4,this.initiateId=i.initiate_id,this.bargainShareDetail().then((function(t){console.log(n.bargainData,"======"),n.bargainData.user_id==n.userInfo.id&&n.bargainProgress()}))):1==i.isShare&&(this.initiateId=i.initiate_id,this.bargainProgress())}},onPullDownRefresh:function(){this.bargainData.user_id==this.userInfo.id?this.bargainProgress():this.bargainShareDetail(),setTimeout((function(){n.stopPullDownRefresh()}),500)}});t.default=s}).call(this,i("df3c")["default"])}},[["865c","common/runtime","common/vendor"]]]);