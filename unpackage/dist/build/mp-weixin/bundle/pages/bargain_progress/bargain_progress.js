require('../../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["bundle/pages/bargain_progress/bargain_progress"],{"2c76":function(n,t,e){"use strict";e.r(t);var i=e("cca9"),a=e("5813");for(var o in a)["default"].indexOf(o)<0&&function(n){e.d(t,n,(function(){return a[n]}))}(o);e("aeb5");var r=e("828b"),s=Object(r["a"])(a["default"],i["b"],i["c"],!1,null,"48060d9e",null,!1,i["a"],void 0);t["default"]=s.exports},"2e6a":function(n,t,e){"use strict";(function(n){var i=e("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=e("7b5f"),o=e("93d1"),r=e("6c77"),s=(e("6c42"),i(e("07c7")),{data:function(){return{pageStatus:o.PageStatusEnum["LOADING"],activityId:0,goodsId:0,bargainData:{help_record:[]},showGoodsSpec:!1,specButtonsList:[],goodsSpecOptions:{},specButtonsGroups:{confirm:{event:"confirm",text:"确认"}},reduceAmount:0,diffPrice:0,needHelp:0,currentPrice:0,precent:0,initiateId:0,showBargainPop:!1,showSharePop:!1,status:0,nowTime:0}},computed:{specValueStr:function(){var n,t,e;return null!==(n=null===(t=this.goodsSpecOptions)||void 0===t||null===(e=t.spec)||void 0===e?void 0:e.spec_value_str)&&void 0!==n?n:""}},methods:{bargainDetail:function(){var n=this;(0,a.apiBargainDetail)({activity_id:this.activityId,goods_id:this.goodsId}).then((function(t){console.log("res",t),n.bargainData=t,n.pageStatus=o.PageStatusEnum["NORMAL"]})).catch((function(t){console.log(t,"1"),n.pageStatus=o.PageStatusEnum["ERROR"]}))},onSelect:function(){this.showGoodsSpec=!0,this.specButtonsList=[this.specButtonsGroups.confirm]},changeGoodsSpec:function(n){this.goodsSpecOptions=n,console.log(n)},handleConfirm:function(n){var t=this,e=n.spec,i=n.number;if(!this.isLogin)return this.$Router.push("/pages/login/login");(0,a.apiBargainInitiate)({activity_id:this.activityId,item_id:e.id,goods_num:i}).then((function(n){console.log("发起砍价",n),t.reduceAmount=n.reduce_amount,t.diffPrice=n.diff_price,t.initiateId=n.initiate_id,t.needHelp=n.need_help,t.bargainProgress(),(n.reduce_amount||n.need_help)&&(t.precent=100*(n.reduce_amount/n.need_help).toFixed(2),t.showBargainPop=!0)}))},bargainProgress:function(){var n=this;(0,a.apiBargainProgress)({initiate_id:this.initiateId}).then((function(t){n.bargainData=t,n.status=t.status,n.bargainData.precent=100*(t.help_total/(t.help_total+t.help_diff)).toFixed(2),n.pageStatus=o.PageStatusEnum["NORMAL"]})).catch((function(t){console.log(t,"2"),n.pageStatus=o.PageStatusEnum["ERROR"]}))},closeBargainPop:function(){this.showBargainPop=!1},shareToBargain:function(){this.showSharePop=!0},onShareAppMessage:function(){return{path:"bundle/pages/bargain_progress/bargain_progress?initiate_id="+this.initiateId+"&isShare=2&invite_code="+this.userInfo.code,title:"我正在参与砍价，还差一步",imageUrl:this.bargainData.goods_image}},bargainShareDetail:function(){var n=this;return new Promise((function(t,e){(0,a.apiBargainShareDetail)({initiate_id:n.initiateId}).then((function(e){console.log(e,"bargainShareDetail"),n.bargainData=e,t(e),n.pageStatus=o.PageStatusEnum["NORMAL"]})).catch((function(t){console.log(t),n.$Router.replace({path:"/pages/login/login"}),e(t)}))}))},goToOrder:function(){this.$Router.push({path:"/pages/order_detail/order_detail",query:{order_id:this.bargainData.order_id}})},goToConfirm:function(n){this.$Router.replace({path:"/pages/goods_order/goods_order",query:{from:o.OrderTypeEnum["BARGAIN"],payload:{initiate_id:this.initiateId,buy_condition:n}}})},onBargain:function(){var n=this;(0,a.apiBargainHelp)({initiate_id:this.initiateId}).then((function(t){console.log("发起砍价",t),n.reduceAmount=t.reduce_amount,n.currentPrice=t.current_price,n.initiateId=t.initiate_id,n.precent=100*((t.need_help-t.diff_price)/t.need_help).toFixed(2),n.$nextTick((function(){this.showBargainPop=!0})),n.bargainShareDetail()}))},onGoodsBargain:function(){n.navigateTo({url:"/bundle/pages/goods_bargain/goods_bargain"})}},onLoad:function(){var n=this,t=new Date;this.nowTime=Date.parse(t)/1e3,console.log("nowTime",this.nowTime);var e=this.$Route.query;console.log(e,"------");var i=e["scene"],a=null===e||void 0===e?void 0:e.id;if(console.log("scene",i),i||a)this.initiateId=i?(0,r.strToParams)(decodeURIComponent(i))["id"]:a,console.log("initiateId",this.initiateId),this.status=4,this.bargainShareDetail().then((function(t){n.bargainData.user_id==n.userInfo.id&&n.bargainProgress()}));else{if(e.goods_id&&(this.goodsId=e.goods_id),e.activity_id)return this.activityId=e.activity_id,void setTimeout((function(){n.bargainDetail()}),50);2==e.isShare?(this.status=4,this.initiateId=e.initiate_id,this.bargainShareDetail().then((function(t){console.log(n.bargainData,"======"),n.bargainData.user_id==n.userInfo.id&&n.bargainProgress()}))):1==e.isShare&&(this.initiateId=e.initiate_id,this.bargainProgress())}},onPullDownRefresh:function(){this.bargainData.user_id==this.userInfo.id?this.bargainProgress():this.bargainShareDetail(),setTimeout((function(){n.stopPullDownRefresh()}),500)}});t.default=s}).call(this,e("df3c")["default"])},5813:function(n,t,e){"use strict";e.r(t);var i=e("2e6a"),a=e.n(i);for(var o in i)["default"].indexOf(o)<0&&function(n){e.d(t,n,(function(){return i[n]}))}(o);t["default"]=a.a},6264:function(n,t,e){"use strict";(function(n,t){var i=e("47a9");e("1ae9");i(e("3240"));var a=i(e("2c76"));n.__webpack_require_UNI_MP_PLUGIN__=e,t(a.default)}).call(this,e("3223")["default"],e("df3c")["createPage"])},aeb5:function(n,t,e){"use strict";var i=e("bc3f"),a=e.n(i);a.a},bc3f:function(n,t,e){},cca9:function(n,t,e){"use strict";e.d(t,"b",(function(){return a})),e.d(t,"c",(function(){return o})),e.d(t,"a",(function(){return i}));var i={navbar:function(){return Promise.all([e.e("common/vendor"),e.e("components/navbar/navbar")]).then(e.bind(null,"5b0f6"))},uImage:function(){return e.e("components/uview-ui/components/u-image/u-image").then(e.bind(null,"7469"))},price:function(){return e.e("components/price/price").then(e.bind(null,"3feb"))},uCountDown:function(){return e.e("components/uview-ui/components/u-count-down/u-count-down").then(e.bind(null,"db08"))},goodsSpec:function(){return Promise.all([e.e("common/vendor"),e.e("components/goods-spec/goods-spec")]).then(e.bind(null,"a182c"))},uPopup:function(){return e.e("components/uview-ui/components/u-popup/u-popup").then(e.bind(null,"c7c8"))},uIcon:function(){return e.e("components/uview-ui/components/u-icon/u-icon").then(e.bind(null,"3ee8"))},sharePopup:function(){return e.e("components/share-popup/share-popup").then(e.bind(null,"a65b"))},pageStatus:function(){return e.e("components/page-status/page-status").then(e.bind(null,"f823"))},uEmpty:function(){return e.e("components/uview-ui/components/u-empty/u-empty").then(e.bind(null,"0719"))}},a=function(){var n=this,t=n.$createElement,e=(n._self._c,0==n.status?{image:n.bargainData.image,price:n.bargainData.goods_max_price,stock:n.bargainData.total_stock,bargain_price:n.bargainData.min_price}:null),i=4==n.status?n.bargainData.help_record.length:null,a=n.reduceAmount.toFixed(2)||0,o={goodsId:n.bargainData.goods_id,activityId:n.bargainData.activity_id},r={image:n.bargainData.goods_image,name:n.bargainData.goods_name};n._isMounted||(n.e0=function(t){n.showGoodsSpec=!1}),n.$mp.data=Object.assign({},{$root:{a0:e,g0:i,g1:a,a1:o,a2:r}})},o=[]}},[["6264","common/runtime","common/vendor"]]]);