(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["uni_modules/lime-painter/components/l-painter/l-painter"],{2418:function(e,t,n){"use strict";n.r(t);var a=n("3043"),r=n.n(a);for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t["default"]=r.a},3043:function(e,t,n){"use strict";(function(e){var a=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n("7eb4")),i=a(n("ee10")),s=n("a10d"),c=a(n("9d06")),u=n("5a1f"),o=a(n("411e")),d={name:"lime-painter",mixins:[c.default,(0,s.parent)("painter"),{}],data:function(){return{use2dCanvas:!0,canvasHeight:150,canvasWidth:null,parentWidth:0,inited:!1,progress:0,firstRender:0,done:!1}},computed:{styles:function(){return"".concat(this.size).concat(this.customStyle||"",";")},canvasId:function(){return"l-painter".concat(this._uid||this._.uid)},size:function(){if(this.boardWidth&&this.boardHeight)return"width:".concat(this.boardWidth,"px; height: ").concat(this.boardHeight,"px;")},dpr:function(){return this.pixelRatio||e.getSystemInfoSync().pixelRatio},boardWidth:function(){var e=this.elements&&this.elements.css||this.elements||this,t=e.width,n=void 0===t?0:t,a=(0,u.toPx)(n||this.width);return a||Math.max(a,(0,u.toPx)(this.canvasWidth))},boardHeight:function(){var e=this.elements&&this.elements.css||this.elements||this,t=e.height,n=void 0===t?0:t,a=(0,u.toPx)(n||this.height);return a||Math.max(a,(0,u.toPx)(this.canvasHeight))},hasBoard:function(){return this.board&&Object.keys(this.board).length},elements:function(){return this.hasBoard?this.board:JSON.parse(JSON.stringify(this.el))}},watch:{size:function(e){this.use2dCanvas&&(this.inited=!1)}},created:function(){var t=e.getSystemInfoSync(),n=t.SDKVersion;t.version,t.platform;this.use2dCanvas="2d"===this.type&&(0,u.compareVersion)(n,"2.9.2")>=0&&!this.isPC},mounted:function(){var e=this;return(0,i.default)(r.default.mark((function t(){return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,u.sleep)(30);case 2:return t.next=4,e.getParentWeith();case 4:e.$nextTick((function(){setTimeout((function(){e.$watch("elements",e.watchRender,{deep:!0,immediate:!0})}),30)}));case 5:case"end":return t.stop()}}),t)})))()},methods:{watchRender:function(e,t){var n=this;return(0,i.default)(r.default.mark((function a(){return r.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(e&&e.views&&(n.firstRender?n.firstRender:e.views.length)&&Object.keys(e).length&&JSON.stringify(e)!=JSON.stringify(t)){a.next=2;break}return a.abrupt("return");case 2:n.firstRender=1,clearTimeout(n.rendertimer),n.rendertimer=setTimeout((function(){n.render(e)}),n.beforeDelay);case 5:case"end":return a.stop()}}),a)})))()},setFilePath:function(e,t){var n=this;return(0,i.default)(r.default.mark((function a(){var i,s,c,o;return r.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(i=e,s=t||n,c=s.pathType,o=void 0===c?n.pathType:c,"base64"!=o||(0,u.isBase64)(e)){a.next=8;break}return a.next=5,(0,u.pathToBase64)(e);case 5:i=a.sent,a.next=12;break;case 8:if("url"!=o||!(0,u.isBase64)(e)){a.next=12;break}return a.next=11,(0,u.base64ToPath)(e);case 11:i=a.sent;case 12:return t&&t.isEmit&&n.$emit("success",i),a.abrupt("return",i);case 14:case"end":return a.stop()}}),a)})))()},getSize:function(e){var t=this;return(0,i.default)(r.default.mark((function n(){var a,i,s,c;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=e.css||e,i=a.width,s=e.css||e,c=s.height,t.size){n.next=12;break}if(!i&&!c){n.next=10;break}return t.canvasWidth=i||t.canvasWidth,t.canvasHeight=c||t.canvasHeight,n.next=8,(0,u.sleep)(30);case 8:n.next=12;break;case 10:return n.next=12,t.getParentWeith();case 12:case"end":return n.stop()}}),n)})))()},canvasToTempFilePathSync:function(e){var t=this;this.stopWatch=this.$watch("done",(function(n){n&&(t.canvasToTempFilePath(e),t.stopWatch&&t.stopWatch())}),{immediate:!0})},getParentWeith:function(){var t=this;return new Promise((function(n){e.createSelectorQuery().in(t).select(".lime-painter").boundingClientRect().exec((function(e){var a=e[0]||{},r=a.width,i=a.height;t.parentWidth=Math.ceil(r||0),t.canvasWidth=t.parentWidth||300,t.canvasHeight=i||t.canvasHeight||150,n(e[0])}))}))},render:function(){var e=arguments,t=this;return(0,i.default)(r.default.mark((function n(){var a,i,s,c,d,h,f,l,p,v,x,m,b,g;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=e.length>0&&void 0!==e[0]?e[0]:{},Object.keys(a).length){n.next=3;break}return n.abrupt("return",console.error("空对象"));case 3:return t.progress=0,t.done=!1,n.next=7,t.getSize(a);case 7:return n.next=9,t.getContext();case 9:if(i=n.sent,s=t.use2dCanvas,c=t.boardWidth,d=t.boardHeight,h=t.canvas,f=t.afterDelay,!s||h){n.next=13;break}return n.abrupt("return",Promise.reject(new Error("render: fail canvas has not been created")));case 13:return t.boundary={top:0,left:0,width:c,height:d},t.painter=null,t.painter||(l=a.css||a,p=l.width,v=a.css||a,v.height,!p&&t.parentWidth&&Object.assign(a,{width:t.parentWidth}),x={context:i,canvas:h,width:c,height:d,pixelRatio:t.dpr,useCORS:t.useCORS,createImage:u.getImageInfo.bind(t),listen:{onProgress:function(e){t.progress=e,t.$emit("progress",e)},onEffectFail:function(e){t.$emit("faill",e)}}},t.painter=new o.default(x)),n.next=18,t.painter.source(JSON.parse(JSON.stringify(a)));case 18:return m=n.sent,b=m.width,g=m.height,t.boundary.height=t.canvasHeight=g,t.boundary.width=t.canvasWidth=b,n.next=25,(0,u.sleep)(t.sleep);case 25:return t.painter.setContext(t.ctx),n.next=28,t.painter.render();case 28:return n.next=30,new Promise((function(e){return t.$nextTick(e)}));case 30:if(s){n.next=33;break}return n.next=33,t.canvasDraw();case 33:if(!f||!s){n.next=36;break}return n.next=36,(0,u.sleep)(f);case 36:return t.$emit("done"),t.done=!0,t.isCanvasToTempFilePath&&t.canvasToTempFilePath().then((function(e){t.$emit("success",e.tempFilePath)})).catch((function(e){t.$emit("fail",new Error(JSON.stringify(e)))})),n.abrupt("return",Promise.resolve({ctx:i,draw:t.painter,node:t.node}));case 40:case"end":return n.stop()}}),n)})))()},canvasDraw:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((function(n,a){return e.ctx.draw(t,(function(){return setTimeout((function(){return n()}),e.afterDelay)}))}))},getContext:function(){var t=this;return(0,i.default)(r.default.mark((function n(){var a,i,s;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.canvasWidth){n.next=4;break}return t.$emit("fail","painter no size"),console.error("painter no size: 请给画板或父级设置尺寸"),n.abrupt("return",Promise.reject());case 4:if(!t.ctx||!t.inited){n.next=6;break}return n.abrupt("return",Promise.resolve(t.ctx));case 6:if(a=t.type,i=t.use2dCanvas,t.dpr,t.boardWidth,t.boardHeight,s=function(){return new Promise((function(n){e.createSelectorQuery().in(t).select("#".concat(t.canvasId)).boundingClientRect().exec((function(a){if(a){var r=e.createCanvasContext(t.canvasId,t);t.inited||(t.inited=!0,t.use2dCanvas=!1,t.canvas=a),t.ctx=r,n(t.ctx)}}))}))},i){n.next=10;break}return n.abrupt("return",s());case 10:return n.abrupt("return",new Promise((function(n){e.createSelectorQuery().in(t).select("#".concat(t.canvasId)).node().exec((function(e){var r=e[0].node;r||(t.use2dCanvas=!1,n(t.getContext()));var i=r.getContext(a);t.inited||(t.inited=!0,t.use2dCanvas=!0,t.canvas=r),t.ctx=i,n(t.ctx)}))})));case 11:case"end":return n.stop()}}),n)})))()},canvasToTempFilePath:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(){var a=(0,i.default)(r.default.mark((function a(s,c){var u,o,d,h,f,l,p,v,x,m,b,g,w,y,P,k,T;return r.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(u=t.use2dCanvas,o=t.canvasId,d=t.dpr,h=t.fileType,f=t.quality,l=function(){var e=(0,i.default)(r.default.mark((function e(n){var a;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.setFilePath(n.tempFilePath||n);case 3:a=e.sent,s(Object.assign(n,{tempFilePath:a})),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),t.$emit("fail",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),p=t.boundary||t,v=p.top,x=void 0===v?0:v,m=p.left,b=void 0===m?0:m,g=p.width,w=p.height,y=g*d,P=w*d,k=Object.assign({x:b,y:x,width:g,height:w,destWidth:y,destHeight:P,canvasId:o,fileType:h,quality:f,success:l,fail:c},n),!u){a.next=22;break}return a.prev=7,n.pathType||t.pathType||(n.pathType="url"),a.next=11,t.setFilePath(t.canvas.toDataURL("image/".concat(n.fileType||h).replace(/pg/,"peg"),n.quality||f),n);case 11:T=a.sent,n.success&&n.success({tempFilePath:T}),s({tempFilePath:T}),a.next=20;break;case 16:a.prev=16,a.t0=a["catch"](7),n.fail&&n.fail(a.t0),c(a.t0);case 20:a.next=23;break;case 22:e.canvasToTempFilePath(k,t);case 23:case"end":return a.stop()}}),a,null,[[7,16]])})));return function(e,t){return a.apply(this,arguments)}}())}}};t.default=d}).call(this,n("df3c")["default"])},"5d66":function(e,t,n){"use strict";var a=n("ee04"),r=n.n(a);r.a},8551:function(e,t,n){"use strict";n.r(t);var a=n("8dc7"),r=n("2418");for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);n("5d66");var s=n("828b"),c=Object(s["a"])(r["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],void 0);t["default"]=c.exports},"8dc7":function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){}));var a=function(){var e=this.$createElement;this._self._c},r=[]},ee04:function(e,t,n){}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'uni_modules/lime-painter/components/l-painter/l-painter-create-component',
    {
        'uni_modules/lime-painter/components/l-painter/l-painter-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('df3c')['createComponent'](__webpack_require__("8551"))
        })
    },
    [['uni_modules/lime-painter/components/l-painter/l-painter-create-component']]
]);
