(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/login/login"],{"397b":function(e,n,t){"use strict";(function(e){var i=t("47a9");Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=i(t("7eb4")),r=i(t("34cf")),a=i(t("ee10")),u=i(t("7ca3")),c=t("8f59"),s=t("d6c2"),l=i(t("8697")),f=t("4a52"),p=i(t("a008")),d=t("de29"),g=t("d8fa");function h(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function m(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?h(Object(t),!0).forEach((function(n){(0,u.default)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):h(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var b={ACCOUNT:1,SMS_CODE:2},v={data:function(){return{password:"",account:"",code:"",loginType:"",isWeixin:"",codeTips:"",showLoginPop:!1,loginData:{},isAgree:!1,showModel:!1,phoneLogin:!1,AgreemenName:"",AgreemenUserName:""}},methods:m(m(m({},(0,c.mapMutations)(["login"])),(0,c.mapActions)(["getUser"])),{},{getPolicyAgreement:function(){var e=this;(0,s.apiPolicyAgreement)({type:1}).then((function(n){e.AgreemenName=n.name})),(0,s.apiPolicyAgreement)({type:2}).then((function(n){e.AgreemenUserName=n.name}))},mnpLogin:function(){var n=this;return(0,a.default)(o.default.mark((function t(){var i,r,a,u,c,l;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n.isAgree){t.next=3;break}return n.showModel=!0,t.abrupt("return");case 3:return t.next=5,(0,g.getUserProfile)();case 5:return i=t.sent,r=i.userInfo,a=r.avatarUrl,u=r.nickName,r.gender,e.showLoading({title:"登录中...",mask:!0}),t.next=13,(0,g.getCode)();case 13:return c=t.sent,t.next=16,(0,s.apiAuthLogin)({code:c,nickname:u,headimgurl:a});case 16:l=t.sent,l.is_new_user?(e.hideLoading(),n.showLoginPop=!0,n.loginData=l):n.loginHandle(l);case 18:case"end":return t.stop()}}),t)})))()},getCodeUrl:function(){this.isAgree?l.default.getWxUrl():this.showModel=!0},oaLogin:function(e){var n=this;return(0,a.default)(o.default.mark((function t(){var i;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,l.default.authLogin(e);case 4:i=t.sent,n.loginHandle(i);case 6:case"end":return t.stop()}}),t)})))()},oaAutoLogin:function(){var n=this.$Route.query.code;if(this.isWeixin=(0,f.isWeixinClient)(),!this.isLogin)return n?this.oaLogin(n):void(this.isWeixin&&this.isOaWxAutoLogin&&l.default.getWxUrl());e.switchTab({url:"/pages/index/index"})},appLogin:function(){var n=this;return(0,a.default)(o.default.mark((function t(){return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n.isAgree){t.next=3;break}return n.showModel=!0,t.abrupt("return");case 3:e.login({provider:"weixin",success:function(t){e.showLoading({title:"登录中...",mask:!0});var i=t.authResult,o=i.openid,r=i.access_token;(0,s.apiAppWxLogin)({openid:o,access_token:r}).then((function(e){n.loginHandle(e)})).finally((function(n){e.hideLoading()}))}});case 4:case"end":return t.stop()}}),t)})))()},loginFun:function(){var e=this;return(0,a.default)(o.default.mark((function n(){var t,i,r,a;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t=e.account,i=e.password,e.telephone,r=e.code,a=e.loginType,t){n.next=4;break}return e.$toast({title:"请输入手机号"}),n.abrupt("return");case 4:if(1!=e.loginType||i){n.next=7;break}return e.$toast({title:"请输入密码"}),n.abrupt("return");case 7:if(2!=e.loginType||r){n.next=10;break}return e.$toast({title:"请输入验证码"}),n.abrupt("return");case 10:if(e.isAgree){n.next=13;break}return e.showModel=!0,n.abrupt("return");case 13:(0,s.apiAccountLogin)({scene:a,account:t,password:1==a?i:"",code:2==a?r:""}).then((function(n){e.loginHandle(n)}));case 14:case"end":return n.stop()}}),n)})))()},loginHandle:function(n){var t=this;return(0,a.default)(o.default.mark((function i(){return o.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(t.login(n),t.getUser(),t.$store.dispatch("getCartNum"),e.hideLoading(),!t.isBindMobile||n.mobile){i.next=6;break}return i.abrupt("return",t.$Router.replace("/pages/bind_mobile/bind_mobile"));case 6:t.goBack();case 7:case"end":return i.stop()}}),i)})))()},goBack:function(){getCurrentPages().length>1?this.$Router.back(1,{success:function(){var e=(0,f.currentPage)(),n=e.onLoad,t=e.options;n&&n(t)}}):p.default.get(d.BACK_URL)?this.$Router.replace(p.default.get(d.BACK_URL)):this.$Router.replaceAll("/pages/index/index"),p.default.remove(d.BACK_URL)},changeLoginType:function(){this.loginType==b.ACCOUNT?this.loginType=b.SMS_CODE:this.loginType==b.SMS_CODE&&(this.loginType=b.ACCOUNT)},sendSMS:function(){var e=this;return(0,a.default)(o.default.mark((function n(){var t,i;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.$refs.uCode.canGetCode){n.next=2;break}return n.abrupt("return");case 2:if(e.account){n.next=5;break}return e.$toast({title:"请输入手机号"}),n.abrupt("return");case 5:return n.prev=5,n.next=8,(0,s.apiCheckMobile)({mobile:e.account});case 8:if(t=n.sent,i=t.has,0!==i){n.next=12;break}return n.abrupt("return",e.$toast({title:"手机号未注册"}));case 12:(0,s.apiLoginCaptcha)({mobile:e.account}).then((function(n){e.$refs.uCode.start()})).catch((function(e){console.log(e)})),n.next=18;break;case 15:n.prev=15,n.t0=n["catch"](5),console.log(n.t0);case 18:case"end":return n.stop()}}),n,null,[[5,15]])})))()},codeChange:function(e){this.codeTips=e},ttLogin:function(){var n=this;return(0,a.default)(o.default.mark((function t(){var i,a,u,c,l,f,p;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,g.getCode)();case 2:return i=t.sent,t.next=5,e.getUserInfo();case 5:if(a=t.sent,u=(0,r.default)(a,2),u[0],c=u[1],c){t.next=12;break}return n.openSetting(),t.abrupt("return");case 12:l=c.userInfo,f=l.avatarUrl,p=l.nickName,e.showLoading({title:"登录中..."}),(0,s.apiToutiaoAuthLogin)({code:i,avatarUrl:f,nickName:p}).then((function(e){n.loginHandle(e)})).catch((function(n){console.log(n),e.hideLoading()}));case 15:case"end":return t.stop()}}),t)})))()},openSetting:function(){e.showModal({title:"温馨提示",content:"您已拒绝授权，是否前往设置打开个人信息授权？",confirmColor:this.themeColor,success:function(n){n.confirm&&e.openSetting()}})},handleSubmitInfo:function(e){var n=this;return(0,a.default)(o.default.mark((function t(){var i;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=n.loginData,t.next=3,(0,s.apiUpdateUser)(e,i.token);case 3:t.sent,n.loginHandle(i);case 5:case"end":return t.stop()}}),t)})))()},closePopup:function(){this.showLoginPop=!1}}),computed:{isPhoneRegister:function(){var e=this.appConfig.register_way;return!!e&&e.some((function(e){return 1==e}))},isBindMobile:function(){var e=this.appConfig.coerce_mobile;return e},loginWay:function(){var e=this.appConfig.login_way;return!!e&&(this.loginType=e[0]||"",e)},hasLoginWay:function(){var e=this;return function(n){return e.loginWay&&e.loginWay.some((function(e){return e==n}))}},isMnpWxAuth:function(){var e=this.appConfig.mnp_wechat_auth;return e},isOaWxAuth:function(){var e=this.appConfig.h5_wechat_auth;return e},isAPPWxAuth:function(){var e=this.appConfig.app_wechat_auth;return e},isOaWxAutoLogin:function(){var e=this.appConfig.h5_auto_wechat_auth;return e},isToutiaoAuth:function(){var e=this.appConfig.toutiao_auth;return e},isDisabled:function(){return(11!=this.account.length||!this.password||1!=this.loginType)&&(11!=this.account.length||!this.code||2!=this.loginType)}},onLoad:function(){this.getPolicyAgreement(),this.mnpLogin=(0,f.trottle)(this.mnpLogin),this.appLogin=(0,f.trottle)(this.appLogin),this.getCodeUrl=(0,f.trottle)(this.getCodeUrl),this.ttLogin=(0,f.trottle)(this.ttLogin)},onUnload:function(){}};n.default=v}).call(this,t("df3c")["default"])},"4a1c":function(e,n,t){"use strict";t.r(n);var i=t("397b"),o=t.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){t.d(n,e,(function(){return i[e]}))}(r);n["default"]=o.a},"575b":function(e,n,t){"use strict";t.r(n);var i=t("a52a"),o=t("4a1c");for(var r in o)["default"].indexOf(r)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(r);t("f617");var a=t("828b"),u=Object(a["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);n["default"]=u.exports},a52a:function(e,n,t){"use strict";t.d(n,"b",(function(){return o})),t.d(n,"c",(function(){return r})),t.d(n,"a",(function(){return i}));var i={uSticky:function(){return t.e("components/uview-ui/components/u-sticky/u-sticky").then(t.bind(null,"62d9"))},uNavbar:function(){return t.e("components/uview-ui/components/u-navbar/u-navbar").then(t.bind(null,"6ff9"))},uField:function(){return t.e("components/uview-ui/components/u-field/u-field").then(t.bind(null,"908f"))},uVerificationCode:function(){return t.e("components/uview-ui/components/u-verification-code/u-verification-code").then(t.bind(null,"4288"))},uCheckbox:function(){return t.e("components/uview-ui/components/u-checkbox/u-checkbox").then(t.bind(null,"3cbf"))},uModal:function(){return t.e("components/uview-ui/components/u-modal/u-modal").then(t.bind(null,"4f0a"))},mploginPopup:function(){return t.e("components/mplogin-popup/mplogin-popup").then(t.bind(null,"4194"))}},o=function(){var e=this,n=e.$createElement,t=(e._self._c,e.$getImageUri("resource/image/shopapi/default/login_bg.png")),i=e.phoneLogin&&2==e.loginType?"获取验证码"==e.codeTips&&11!==e.account.length:null,o=e.phoneLogin?e.appConfig.login_way.length:null,r=e.phoneLogin?e.hasLoginWay(2)&&2==e.loginType:null,a=e.phoneLogin?e.hasLoginWay(1)&&1==e.loginType:null;e._isMounted||(e.e0=function(n){e.phoneLogin=!e.phoneLogin},e.e1=function(n){e.isAgree=!0,e.showModel=!1},e.e2=function(n){e.showModel=!1}),e.$mp.data=Object.assign({},{$root:{m0:t,g0:i,g1:o,m1:r,m2:a}})},r=[]},af17:function(e,n,t){"use strict";(function(e,n){var i=t("47a9");t("5c7a");i(t("3240"));var o=i(t("575b"));e.__webpack_require_UNI_MP_PLUGIN__=t,n(o.default)}).call(this,t("3223")["default"],t("df3c")["createPage"])},d8df:function(e,n,t){e.exports={red_theme:"#FF2C3C",orange_theme:"#f7971e",pink_theme:"#fa444d",gold_theme:"#e0a356",blue_theme:"#2f80ed",green_theme:"#2ec840"}},f617:function(e,n,t){"use strict";var i=t("d8df"),o=t.n(i);o.a}},[["af17","common/runtime","common/vendor"]]]);