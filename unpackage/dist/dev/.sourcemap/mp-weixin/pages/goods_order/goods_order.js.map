{"version":3,"sources":["uni-app:///main.js","webpack:////Users/lisicheng/project/mobile/pages/goods_order/goods_order.vue?1b55","webpack:////Users/lisicheng/project/mobile/pages/goods_order/goods_order.vue?5c92","webpack:////Users/lisicheng/project/mobile/pages/goods_order/goods_order.vue?cdce","webpack:////Users/lisicheng/project/mobile/pages/goods_order/goods_order.vue?3bef","uni-app:///pages/goods_order/goods_order.vue","webpack:////Users/lisicheng/project/mobile/pages/goods_order/goods_order.vue?a3e5","webpack:////Users/lisicheng/project/mobile/pages/goods_order/goods_order.vue?3b1f"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","name","data","from","pageStatus","pageErrorMsg","deliveryTypeTabsList","id","sign","deliveryTypeTabsIndex","pageQueryPayload","orderFrom","delivery_type","user_remark","coupon_list_id","address_id","selffetch_shop_id","contact","mobile","showCoupons","couponTabsList","couponTabsIndex","couponsInfo","can_use","not_can_use","couponsActive","addressInfo","selffetchStoreInfo","orderInfo","orderGoodsList","disableGoods","showDisabled","goodsLength","showModal","computed","orderFormParams","orderExtendParams","params","order_type","isMarketing","deliveryActive","couponsTabActive","watch","val","msg","immediate","methods","initDeliveryType","then","selffetch","express","deliveries","item","resolve","catch","initOrderData","action","initCouponGoods","goods","cart_id","source","num","item_id","cart_ids","changeCouponUse","coupon","useCoupon","openCouponsPopup","closeCouponsPopup","changeDeliveryType","selffetch_info","console","onAddressSelect","uni","path","query","type","onStoreSelect","checkOrder","onSubmitOrder","title","content","confirmColor","success","confirm","res","handleSubscribeMP_WEIXIN","tmplIds","fail","reject","handlePlaceOrder","order_id","handlePayResult","handledisBuy","onLoad","options","onUnload"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,oBAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAoI;AACpI;AAC+D;AACL;AACsC;;;AAGhG;AAC6M;AAC7M,gBAAgB,iNAAU;AAC1B,EAAE,iFAAM;AACR,EAAE,kGAAM;AACR,EAAE,2GAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,sGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,yOAEN;AACP,KAAK;AACL;AACA,aAAa,iNAEN;AACP,KAAK;AACL;AACA,aAAa,qSAEN;AACP,KAAK;AACL;AACA,aAAa,qMAEN;AACP,KAAK;AACL;AACA,aAAa,uKAEN;AACP,KAAK;AACL;AACA,aAAa,wOAEN;AACP,KAAK;AACL;AACA,aAAa,+OAEN;AACP,KAAK;AACL;AACA,aAAa,2MAEN;AACP,KAAK;AACL;AACA,aAAa,+OAEN;AACP,KAAK;AACL;AACA,aAAa,2MAEN;AACP,KAAK;AACL;AACA,aAAa,+OAEN;AACP,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACjKA;AAAA;AAAA;AAAA;AAA0zB,CAAgB,yyBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;ACojB90B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAOA;AAAA;AAAA;AAAA,eAGA;EACAC;EAEAC;IACA;MACAC;MAAA;MACA;MACAC;MACAC;MAAA;;MAEA;MACAC,uBACA;QACAC;QACAN;QACAO;MACA,GACA;QACAD;QACAN;QACAO;MACA,EACA;MACAC;MAAA;;MAEAC;MAAA;MACA;MACAC;QACAC;QAAA;QACAC;QAAA;QACAC;QAAA;QACAC;QAAA;QACAC;QAAA;QACAC;QAAA;QACAC;MACA;;MAEA;MACAC;MAAA;MACA;MACAC,iBACA;QACAZ;QACAP;MACA,GACA;QACAO;QACAP;MACA,EACA;MACAoB;MAAA;MACA;MACAC;QACAC;QACAC;MACA;MACAC;MAAA;MACA;;MAEAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MACAC;IACA;EACA;;EAEAC;IACA;IACAC;MACA;MACA;MACA;QACA;UACA;UACA;UACA;UACA;QACA;UACA;UACA;MAAA;MAEA;IACA;IAEA;IACAC;MACA;MAEA;QACA;QACA;UACA;QACA;QACA;UACAC;UACA;QACA;QACA;UACAA;UACA;QACA;QACA;UACAA;UACA;QACA;QACA;UACAA;UACA;MAAA;MAGA;QAAAC;MAAA;IACA;IAEA;IACAC;MACA;QACA;QACA;QACA;UACA;QACA;UACA;MAAA;IAEA;IAEA;IACAC;MACA;IACA;IAEA;IACAC;MACA;IACA;EACA;EACAC;IACA;IACAZ;MAAA;MACAa;QACA;UAAAC;QAAA;MACA;IACA;IACAC;EACA;EACAC;IACA;IACAC;MAAA;MACA;QACA,8BACAC;UACA;YAAAC;UACA;UACA;UACA;UACAC;UACAD;UACA;UACA;YAAA,OACAE;UAAA,EACA;UACA;YACA;cACA;gBACAC;gBACA;cACA;gBACAA;gBACA;YAAA;UAEA;UACA;UACA;UACAC;QACA,GACAC;UAAA;QAAA;MACA;IACA;IAEA;IACAC;MAAA;MACA;QACA,sFACA,yBACA,0BACA;UACAC;QAAA,GACA,CACAR;UAAA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACAK;QACA,GACAC;UAAA;QAAA;MACA;IACA;IAEA;IACA;IACAG;MAAA;MACA;QACA;QACA;UAAAC;UAAAC;UAAAC;;QAEA;QACA;UACA;YACA;cAAA;gBACAC;gBACAC;cACA;YAAA;YACAzB;cAAAqB;cAAAE;YAAA;YACA;UACA;YACAvB;cAAA0B;cAAAH;YAAA;YACA;QAAA;QAGA,6CACAvB,QACA,CACAW;UACA9C;YAAA;UAAA;UACA;UACA;YACAA;YACA;UACA;UACA;QACA,GACA8C;UACA;UACA;UACA;YACA;cACA;gBACAI;gBACA;cACA;gBACAA;gBACA;YAAA;UAEA;UACAC;QACA,GACAC;UAAA;QAAA;MACA;IACA;IAEA;IACAU;MACA;QAAA;MAAA;MACAC;IACA;IAEA;IACAC;MACA;MACA;QAAA;MAAA;MACA;MACA;MACA;IACA;IAEA;IACAC;MAAA;MACA;QACA,2CACA;UAAA;QAAA,EACA;QACAF;MACA;IACA;IAEA;IACAG;MACA;QACA;UAAA;QAAA;MACA;IACA;IACA;IAEA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACA;gBACA;gBAAA;gBAAA;gBAAA,OAEA;cAAA;gBAAA;gBAAAC;gBACA;kBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAC;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA;IACAC;MAAA;MACA;MACAC;QAAA;QACAlE;QACA;MACA;MAEA;QACAmE;QACAC;UACAC;QACA;MACA;IACA;IAEA;IACAC;MAAA;MACA;MACAJ;QACA;QACA;QACA;MACA;MAEA;QACAC;MACA;IACA;IACA;IACAI;MACA;;MAEA;MACA;QACA;UACA;YACA;UACA;UACA;QACA;UACA;YACA;UACA;UACA;MAAA;IAEA;IACA;IACAC;MAAA;MACA;MACA;QACA;MACA;MACA,IACA,qCACA,8BACA,4CACA,gCACA;QACA;UACAC;QACA;MACA;MACA;QACA;MACA;QACA;UACAA;QACA;MACA;MACAP;QACAO;QACAC;QACAC;QACAC;UAAA;YAAA;YAAA;cAAA;gBAAA;kBAAA;oBAAAC;oBAAA;oBAAA,IAEAA;sBAAA;sBAAA;oBAAA;oBAAA;kBAAA;oBAAA;oBAAA;oBAAA,OAKA;kBAAA;oBAAA;oBAAA;kBAAA;oBAAA;oBAAA;oBAGAb;kBAAA;oBAAA;oBAAA,OAGA;kBAAA;oBAAAc;oBACAd;oBAAA;oBAAA;kBAAA;oBAAA;oBAAA;oBAEAA;oBACA;sBACA;oBACA;sBACA;wBAAAS;sBAAA;oBACA;kBAAA;kBAAA;oBAAA;gBAAA;cAAA;YAAA;UAAA,CAEA;UAAA;YAAA;UAAA;UAAA;QAAA;MACA;IACA;IAEA;IACAM;MACA;QACA,yBACAtC;UACA;UACAyB;YACAc;YACAJ;cACA9B;YACA;YACAmC;cACAC;YACA;UACA;QACA,GACAnC;UAAA;QAAA;MACA;IACA;IAEA;IACAoC;MAAA;MACA;QACA,sFACA,0BACA,2BACA;UACAlC;QAAA,GACA,CACAR;UACA;UACAyB;YACA;UACA;UACA;QACA,GACAzB;UAAA;YAAA2C;UACA;UACA;YACAjB;YACAC;cACAxE;cACAwF;YACA;UACA;UACAtC;QACA,GACAC;UAAA;QAAA;MACA;IACA;IAEA;IACAsC;MAAA;QAAAD;MACA;QACA;QACA;UACA;YACAjB;YACAC;cAAAgB;cAAAxF;YAAA;UACA;UACA;QACA;UACA;YACAuE;YACAC;cAAAgB;cAAAxF;YAAA;UACA;UACA;MAAA;IAEA;IACA;IACA0F;MACA;QACAnB;MACA;IACA;EACA;EAEAoB;IAAA;IAAA;MAAA;MAAA;QAAA;UAAA;YAAA;cACAC;cACAxB;cACA;cAAA;cAEA;cACA;cACA;cACA;cACA;cAAA,MACAwB;gBAAA;gBAAA;cAAA;cACA;cAAA;cAAA;YAAA;cAAA;cAAA,OAEA;YAAA;cAAA,eAGA;cAAA;gBAAA;gBAAA;cAAA;cAAA;cAAA;YAAA;cACA;cACA;cACA;cAAA;cAAA,OACA;YAAA;cAEA;cAAA;cAAA;YAAA;cAAA;cAAA;cAEA;cACA;cACAxB;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA;EAEA;EAEAyB;IACAvB;EACA;AACA;AAAA,2B;;;;;;;;;;;;;AC1kCA;AAAA;AAAA;AAAA;AAAqiD,CAAgB,g8CAAG,EAAC,C;;;;;;;;;;;ACAzjD;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/goods_order/goods_order.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/goods_order/goods_order.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./goods_order.vue?vue&type=template&id=db6a795c&scoped=true&\"\nvar renderjs\nimport script from \"./goods_order.vue?vue&type=script&lang=js&\"\nexport * from \"./goods_order.vue?vue&type=script&lang=js&\"\nimport style0 from \"./goods_order.vue?vue&type=style&index=0&id=db6a795c&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"db6a795c\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/goods_order/goods_order.vue\"\nexport default component.exports","export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./goods_order.vue?vue&type=template&id=db6a795c&scoped=true&\"","var components\ntry {\n  components = {\n    uTabs: function () {\n      return import(\n        /* webpackChunkName: \"components/uview-ui/components/u-tabs/u-tabs\" */ \"@/components/uview-ui/components/u-tabs/u-tabs.vue\"\n      )\n    },\n    addressCard: function () {\n      return import(\n        /* webpackChunkName: \"components/address-card/address-card\" */ \"@/components/address-card/address-card.vue\"\n      )\n    },\n    uInput: function () {\n      return import(\n        /* webpackChunkName: \"components/uview-ui/components/u-input/u-input\" */ \"@/components/uview-ui/components/u-input/u-input.vue\"\n      )\n    },\n    goodsCard: function () {\n      return import(\n        /* webpackChunkName: \"components/goods-card/goods-card\" */ \"@/components/goods-card/goods-card.vue\"\n      )\n    },\n    price: function () {\n      return import(\n        /* webpackChunkName: \"components/price/price\" */ \"@/components/price/price.vue\"\n      )\n    },\n    uIcon: function () {\n      return import(\n        /* webpackChunkName: \"components/uview-ui/components/u-icon/u-icon\" */ \"@/components/uview-ui/components/u-icon/u-icon.vue\"\n      )\n    },\n    uPopup: function () {\n      return import(\n        /* webpackChunkName: \"components/uview-ui/components/u-popup/u-popup\" */ \"@/components/uview-ui/components/u-popup/u-popup.vue\"\n      )\n    },\n    couponCard: function () {\n      return import(\n        /* webpackChunkName: \"components/coupon-card/coupon-card\" */ \"@/components/coupon-card/coupon-card.vue\"\n      )\n    },\n    uEmpty: function () {\n      return import(\n        /* webpackChunkName: \"components/uview-ui/components/u-empty/u-empty\" */ \"@/components/uview-ui/components/u-empty/u-empty.vue\"\n      )\n    },\n    pageStatus: function () {\n      return import(\n        /* webpackChunkName: \"components/page-status/page-status\" */ \"@/components/page-status/page-status.vue\"\n      )\n    },\n    uModal: function () {\n      return import(\n        /* webpackChunkName: \"components/uview-ui/components/u-modal/u-modal\" */ \"@/components/uview-ui/components/u-modal/u-modal.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 = _vm.orderInfo.is_address ? _vm.deliveryTypeTabsList.length : null\n  var g1 = _vm.orderInfo.is_address ? JSON.stringify(_vm.addressInfo) : null\n  var l0 = _vm.__map(_vm.orderGoodsList, function (item, __i0__) {\n    var $orig = _vm.__get_orig(item)\n    var a0 = {\n      \"border-raius\": 0,\n      height: \"220rpx\",\n    }\n    return {\n      $orig: $orig,\n      a0: a0,\n    }\n  })\n  var g2 = _vm.disableGoods.length\n  var g3 = g2 ? _vm.disableGoods.length : null\n  var g4 = _vm.couponsInfo.can_use.length\n  var l1 = _vm.__map(_vm.couponsInfo.not_can_use, function (item, __i2__) {\n    var $orig = _vm.__get_orig(item)\n    var a1 = {\n      title: item.fail_use_tips,\n      content: item.fail_use_detail,\n    }\n    return {\n      $orig: $orig,\n      a1: a1,\n    }\n  })\n  var g5 = _vm.couponsInfo.not_can_use.length\n  var l2 = _vm.__map(_vm.disableGoods, function (item, __i3__) {\n    var $orig = _vm.__get_orig(item)\n    var a2 = {\n      \"border-raius\": 0,\n      height: \"220rpx\",\n    }\n    return {\n      $orig: $orig,\n      a2: a2,\n    }\n  })\n  if (!_vm._isMounted) {\n    _vm.e0 = function ($event) {\n      _vm.showCoupons = true\n    }\n    _vm.e1 = function ($event) {\n      _vm.showDisabled = true\n    }\n    _vm.e2 = function ($event) {\n      _vm.showCoupons = false\n    }\n    _vm.e3 = function (index) {\n      return (_vm.couponTabsIndex = index)\n    }\n    _vm.e4 = function ($event) {\n      _vm.showDisabled = false\n    }\n    _vm.e5 = function ($event) {\n      _vm.showDisabled = false\n    }\n    _vm.e6 = function ($event) {\n      _vm.showDisabled = false\n    }\n  }\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n        g1: g1,\n        l0: l0,\n        g2: g2,\n        g3: g3,\n        g4: g4,\n        l1: l1,\n        g5: g5,\n        l2: l2,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./goods_order.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./goods_order.vue?vue&type=script&lang=js&\"","<template>\n    <view class=\"goods-order\" :class=\"themeName\">\n        <!-- 配送方式 -->\n        <view class=\"contain delivery\" v-if=\"orderInfo.is_address\">\n            <view class=\"delivery-tabs\">\n                <u-tabs\n                    :list=\"deliveryTypeTabsList\"\n                    :is-scroll=\"false\"\n                    :height=\"88\"\n                    :active-color=\"themeColor\"\n                    :bar-style=\"{ top: '100%' }\"\n                    :bar-width=\"100\"\n                    :current=\"deliveryTypeTabsIndex\"\n                    @change=\"changeDeliveryType\"\n                    v-show=\"deliveryTypeTabsList.length == 2\"\n                />\n            </view>\n\n            <!-- 快递配送 -->\n            <view\n                class=\"delivery-contain\"\n                v-show=\"deliveryActive['sign'] === 'express'\"\n                @tap=\"onAddressSelect\"\n            >\n                <address-card :action=\"true\" :has-content=\"JSON.stringify(addressInfo) !== '[]'\">\n                    <template slot=\"header\">\n                        <text>{{ addressInfo.contact }}</text>\n                        <text class=\"m-l-10\">{{ addressInfo.mobile }}</text>\n                    </template>\n                    <template slot=\"main\">\n                        <text>{{ addressInfo.province }}</text>\n                        <text class=\"m-l-10\">{{ addressInfo.city }}</text>\n                        <text class=\"m-l-10\">{{ addressInfo.district }}</text>\n                        <text class=\"m-l-10\">{{ addressInfo.address }}</text>\n                    </template>\n                </address-card>\n            </view>\n            <!-- v-if=\"from != 4\" -->\n            <!-- 门店自提 -->\n            <view\n                class=\"delivery-contain\"\n                v-show=\"deliveryActive['sign'] === 'store'\"\n                @tap=\"onStoreSelect\"\n            >\n                <address-card\n                    :action=\"true\"\n                    :has-content=\"!!orderFrom.selffetch_shop_id\"\n                    placeholder=\"请选择门店地址\"\n                >\n                    <template slot=\"header\">\n                        <text>{{ selffetchStoreInfo.name }}</text>\n                    </template>\n                    <template slot=\"main\">\n                        <text>{{ selffetchStoreInfo.detailed_address }}</text>\n                    </template>\n                    <template slot=\"footer\">\n                        <text>\n                            <text>营业时间：</text>\n                            <text>{{ selffetchStoreInfo.business_start_time }}</text>\n                            <text>-</text>\n                            <text>{{ selffetchStoreInfo.business_end_time }}</text>\n                        </text>\n                    </template>\n                </address-card>\n            </view>\n        </view>\n\n        <!-- 门店自提表单 -->\n        <view\n            class=\"contain store-from\"\n            v-show=\"deliveryActive['sign'] === 'store'\"\n            v-if=\"orderInfo.is_address\"\n        >\n            <view class=\"store-from-item\">\n                <text>提货人</text>\n                <u-input\n                    v-model=\"orderFrom.contact\"\n                    class=\"flex-1\"\n                    type=\"text\"\n                    input-align=\"right\"\n                    placeholder=\"请输入提货人\"\n                    :clearable=\"false\"\n                />\n            </view>\n            <view class=\"store-from-item\">\n                <text>联系方式</text>\n                <u-input\n                    :maxlength=\"11\"\n                    v-model=\"orderFrom.mobile\"\n                    class=\"flex-1\"\n                    type=\"text\"\n                    input-align=\"right\"\n                    placeholder=\"请输入联系方式\"\n                    :clearable=\"false\"\n                />\n            </view>\n        </view>\n\n        <!-- 订单商品 -->\n        <view class=\"contain\">\n            <!-- 商品列表 -->\n            <view class=\"goods\">\n                <view v-for=\"item in orderGoodsList\" :key=\"item.id\" class=\"goods-item\">\n                    <goods-card\n                        shape=\"rectangle\"\n                        :name=\"item.goods_name\"\n                        :image=\"item.item_image ? item.item_image : item.image\"\n                        :contain-style=\"{ 'border-raius': 0, height: '220rpx' }\"\n                        :image-style=\"{ width: '160rpx', height: '160rpx' }\"\n                        :disableMsg=\"item.msg\"\n                    >\n                        <view class=\"flex-1\" slot=\"default\">\n                            <text class=\"muted xs m-t-10 red\" v-show=\"item.msg == '找不到商品'\"\n                                >该商品不存在</text\n                            >\n                            <text class=\"muted xs m-t-10 skuline\">{{ item.spec_value_str }}</text>\n                            <view class=\"m-t-10 flex row-between\">\n                                <view class=\"flex\" v-show=\"item.original_price\">\n                                    <!-- 售价 -->\n                                    <price\n                                        :content=\"item.original_price\"\n                                        mainSize=\"32rpx\"\n                                        minorSize=\"24rpx\"\n                                    />\n\n                                    <!-- 普通商品或者虚拟商品会员价 用户有登陆且且该商品有设置会员价才显示 -->\n                                    <view\n                                        class=\"vip-price flex m-l-10\"\n                                        v-if=\"\n                                            !!item.member_price &&\n                                            (orderInfo.order_type == 0 || orderInfo.order_type == 4)\n                                        \"\n                                    >\n                                        <view class=\"price-name xxs\">会员价</view>\n                                        <view style=\"padding: 0 10rpx\">\n                                            <price\n                                                :content=\"item.sell_price\"\n                                                :weight=\"500\"\n                                                color=\"#7B3200\"\n                                            >\n                                            </price>\n                                        </view>\n                                    </view>\n                                    <!-- 其他活动价 -->\n                                    <view\n                                        class=\"vip-price flex m-l-10\"\n                                        v-if=\"\n                                            orderInfo.order_type == 1 ||\n                                            orderInfo.order_type == 2 ||\n                                            orderInfo.order_type == 3 ||\n                                            orderInfo.order_type == 5\n                                        \"\n                                    >\n                                        <view\n                                            class=\"price-name xxs\"\n                                            v-if=\"orderInfo.order_type == 1\"\n                                            >拼团价</view\n                                        >\n                                        <view\n                                            class=\"price-name xxs\"\n                                            v-if=\"orderInfo.order_type == 2\"\n                                            >秒杀价</view\n                                        >\n                                        <view\n                                            class=\"price-name xxs\"\n                                            v-if=\"orderInfo.order_type == 3\"\n                                            >砍价</view\n                                        >\n                                        <view\n                                            class=\"price-name xxs\"\n                                            v-if=\"orderInfo.order_type == 5\"\n                                            >预售</view\n                                        >\n                                        <view style=\"padding: 0 10rpx\">\n                                            <price\n                                                :content=\"item.sell_price\"\n                                                :weight=\"500\"\n                                                color=\"#7B3200\"\n                                            >\n                                            </price>\n                                        </view>\n                                    </view>\n                                </view>\n\n                                <text class=\"lighter sm\" v-show=\"!!item.goods_num\"\n                                    >x{{ item.goods_num }}</text\n                                >\n                            </view>\n                        </view>\n                    </goods-card>\n                    <!-- 商品小附件 -->\n                    <view class=\"goods-item-widget\" v-if=\"from != 4\">\n                        <view\n                            v-if=\"deliveryActive['sign'] === 'express' && !item.is_express\"\n                            class=\"delivery-tag\"\n                            >该商品不支持快递配送</view\n                        >\n                        <view\n                            v-if=\"deliveryActive['sign'] === 'store' && !item.is_selffetch\"\n                            class=\"delivery-tag\"\n                            >该商品不支持门店自提</view\n                        >\n                    </view>\n                </view>\n            </view>\n\n            <!-- 买家留言 -->\n            <view class=\"cell remark\">\n                <view class=\"cell-label\">买家留言</view>\n                <view class=\"cell-content\">\n                    <u-input\n                        v-model=\"orderFrom.user_remark\"\n                        class=\"flex-1\"\n                        type=\"text\"\n                        :clearable=\"false\"\n                        :maxlength=\"150\"\n                        placeholder=\"请添加备注（150字以内）\"\n                    />\n                </view>\n            </view>\n        </view>\n\n        <!-- 优惠 -->\n        <view class=\"contain discounts\" v-if=\"!isMarketing\">\n            <!-- 优惠券 -->\n            <view class=\"cell discounts-item\" @tap=\"showCoupons = true\">\n                <view class=\"cell-lable\">优惠券</view>\n                <view class=\"cell-content m-r-10\" :style=\"{ color: themeColor }\">{{\n                    couponsActive.name || ''\n                }}</view>\n                <u-icon name=\"arrow-right\" />\n            </view>\n            <!-- 积分抵扣 -->\n            <!-- \t\t\t<view class=\"cell discounts-item\">\n\t\t\t\t<view class=\"cell-label\">积分抵扣</view>\n\t\t\t\t<view class=\"cell-content\"></view>\n\t\t\t\t<u-checkbox \n\t\t\t\t  v-model=\"\" \n\t\t\t\t  class=\"u-checkbox\"\n\t\t\t\t  shape=\"circle\" \n\t\t\t\t  :label-disabled=\"false\" \n\t\t\t\t  :active-color=\"themeColor\"\n\t\t\t\t/>\n\t\t\t</view> -->\n        </view>\n\n        <!-- 订单清算 -->\n        <view class=\"contain clearing\">\n            <view class=\"cell clearing-item\">\n                <view class=\"cell-label\">商品金额</view>\n                <view class=\"cell-content\">\n                    <price\n                        v-if=\"orderInfo.order_type == 0 || orderInfo.order_type == 4\"\n                        :content=\"orderInfo.total_goods_original_price\"\n                    />\n                    <price v-else :content=\"orderInfo.total_goods_price\" />\n                </view>\n            </view>\n            <view class=\"cell clearing-item\">\n                <view class=\"cell-label\">运费</view>\n                <view class=\"cell-content\">\n                    <price :content=\"orderInfo.express_price\" />\n                </view>\n            </view>\n\n            <view class=\"cell clearing-item\" v-if=\"!isMarketing && orderInfo.discount_amount > 0\">\n                <view class=\"cell-label\">优惠券</view>\n                <view class=\"cell-content\">\n                    <price :content=\"orderInfo.discount_amount\" prefix=\"-￥\" :color=\"themeColor\" />\n                </view>\n            </view>\n            <view class=\"cell clearing-item\" v-if=\"orderInfo.member_amount > 0\">\n                <view class=\"cell-label\">会员折扣</view>\n                <view class=\"cell-content\">\n                    <price :content=\"orderInfo.member_amount\" :color=\"themeColor\" prefix=\"-￥\" />\n                </view>\n            </view>\n        </view>\n        <!-- 不可购买商品 -->\n        <view class=\"goods-disable\" v-if=\"disableGoods.length\">\n            <view class=\"flex\">\n                <view v-for=\"(item, index) in disableGoods\" :key=\"item.id\">\n                    <image\n                        :src=\"item.goods.image\"\n                        mode=\"scaleToFill\"\n                        class=\"m-r-10 image\"\n                        v-if=\"index <= 2\"\n                    />\n                </view>\n                <view> {{ disableGoods.length }}件商品无法购买 </view>\n            </view>\n\n            <view class=\"text\" @click=\"showDisabled = true\">查看</view>\n        </view>\n        <!-- 订单操作 -->\n        <view class=\"operational\">\n            <view class=\"order-amount\">\n                <text>合计:</text>\n                <price\n                    :content=\"orderInfo.order_amount\"\n                    mainSize=\"38rpx\"\n                    minorSize=\"30rpx\"\n                    :color=\"themeColor\"\n                />\n            </view>\n            <view\n                class=\"operational-button\"\n                @tap=\"onSubmitOrder\"\n                :style=\"{ opacity: goodsLength == 0 ? 0.5 : 1 }\"\n                >提交订单</view\n            >\n        </view>\n\n        <!-- 优惠券【弹窗】 -->\n        <u-popup\n            v-model=\"showCoupons\"\n            mode=\"bottom\"\n            border-radius=\"14\"\n            :closeable=\"false\"\n            :safe-area-inset-bottom=\"true\"\n            @open=\"openCouponsPopup\"\n            @close=\"closeCouponsPopup\"\n        >\n            <view class=\"coupons\">\n                <view class=\"coupons-header\">\n                    <text>优惠券</text>\n                    <u-icon name=\"close\" color=\"#666666\" @tap=\"showCoupons = false\" />\n                </view>\n\n                <view class=\"coupons-main\">\n                    <view class=\"coupons-main__tabs\">\n                        <u-tabs\n                            v-if=\"showCoupons\"\n                            :list=\"couponTabsList\"\n                            :is-scroll=\"false\"\n                            :current=\"couponTabsIndex\"\n                            :height=\"80\"\n                            :active-color=\"themeColor\"\n                            :bar-style=\"{ top: '100%' }\"\n                            :bar-width=\"100\"\n                            :show-bar=\"true\"\n                            @change=\"(index) => (couponTabsIndex = index)\"\n                        />\n                    </view>\n\n                    <view class=\"coupons-main__contain\">\n                        <!-- 可用优惠券 -->\n                        <scroll-view\n                            :scroll-y=\"true\"\n                            style=\"height: 700rpx\"\n                            v-show=\"couponsTabActive['sign'] === 'usable'\"\n                        >\n                            <view\n                                class=\"coupons-item\"\n                                v-for=\"item in couponsInfo.can_use\"\n                                :key=\"item.id\"\n                            >\n                                <coupon-card\n                                    mode=\"radio\"\n                                    :discount_max_money=\"item.discount_max_money\"\n                                    :discount_ratio=\"item.discount_ratio\"\n                                    :condition_type=\"item.condition_type\"\n                                    :name=\"item.name\"\n                                    :money=\"item.money\"\n                                    :condition=\"item.condition_tips\"\n                                    :time=\"item.use_time_text2\"\n                                    :scene=\"item.goods_tips\"\n                                    :coupon-id=\"item.id\"\n                                    :checked.sync=\"item.checked\"\n                                    :desc=\"{\n                                        title: '',\n                                        content: ''\n                                    }\"\n                                    @change=\"changeCouponUse(item, $event)\"\n                                />\n                            </view>\n                            <u-empty\n                                v-if=\"!couponsInfo.can_use.length\"\n                                text=\"暂无优惠券\"\n                                src=\"/static/images/empty/coupon_icon.png\"\n                                :icon-size=\"180\"\n                            />\n                        </scroll-view>\n                        <!-- 不可用优惠券 -->\n                        <scroll-view\n                            :scroll-y=\"true\"\n                            style=\"height: 700rpx\"\n                            v-show=\"couponsTabActive['sign'] === 'disabled'\"\n                        >\n                            <view\n                                class=\"coupons-item\"\n                                v-for=\"item in couponsInfo.not_can_use\"\n                                :key=\"item.id\"\n                            >\n                                <coupon-card\n                                    mode=\"normal\"\n                                    :discount_max_money=\"item.discount_max_money\"\n                                    :discount_ratio=\"item.discount_ratio\"\n                                    :condition_type=\"item.condition_type\"\n                                    :name=\"item.name\"\n                                    :money=\"item.money\"\n                                    :condition=\"item.condition_tips\"\n                                    :time=\"item.use_time_text2\"\n                                    :scene=\"item.goods_tips\"\n                                    :coupon-id=\"item.id\"\n                                    :desc=\"{\n                                        title: item.fail_use_tips,\n                                        content: item.fail_use_detail\n                                    }\"\n                                />\n                            </view>\n                            <u-empty\n                                v-if=\"!couponsInfo.not_can_use.length\"\n                                text=\"暂无优惠券\"\n                                src=\"/static/images/empty/coupon_icon.png\"\n                                :icon-size=\"180\"\n                            />\n                        </scroll-view>\n                    </view>\n                </view>\n\n                <view class=\"coupons-footer\">\n                    <view class=\"coupons-footer-button\" @tap=\"useCoupon\">确认</view>\n                </view>\n            </view>\n        </u-popup>\n        <!-- 不可下单商品列表弹框 -->\n        <u-popup\n            v-model=\"showDisabled\"\n            mode=\"bottom\"\n            border-radius=\"14\"\n            :closeable=\"false\"\n            :safe-area-inset-bottom=\"true\"\n            @close=\"showDisabled = false\"\n        >\n            <view class=\"coupons-header\">\n                <text>以下商品不可购买</text>\n                <u-icon name=\"close\" color=\"#666666\" @tap=\"showDisabled = false\" />\n            </view>\n            <scroll-view :scroll-y=\"true\" style=\"height: 700rpx\">\n                <view v-for=\"item in disableGoods\" :key=\"item.id\" class=\"goods-item\">\n                    <goods-card\n                        shape=\"rectangle\"\n                        :name=\"item.goods.goods_name\"\n                        :image=\"item.goods.image\"\n                        :contain-style=\"{ 'border-raius': 0, height: '220rpx' }\"\n                        :image-style=\"{ width: '160rpx', height: '160rpx' }\"\n                        :disableMsg=\"item.msg\"\n                    >\n                        <view class=\"flex-1\" slot=\"default\">\n                            <text class=\"muted xs m-t-10 red\">{{ item.msg }}</text>\n                            <view class=\"m-t-10 flex row-between\">\n                                <view class=\"flex\" v-show=\"item.goods.sell_price\">\n                                    <!-- 售价 -->\n                                    <price\n                                        :content=\"item.goods.sell_price\"\n                                        mainSize=\"32rpx\"\n                                        minorSize=\"24rpx\"\n                                    />\n\n                                    <!-- 普通商品或者虚拟商品会员价 用户有登陆且且该商品有设置会员价才显示 -->\n                                    <view\n                                        class=\"vip-price flex m-l-10\"\n                                        v-if=\"\n                                            !!item.goods.member_price &&\n                                            (orderInfo.order_type == 0 || orderInfo.order_type == 4)\n                                        \"\n                                    >\n                                        <view class=\"price-name xxs\">会员价</view>\n                                        <view style=\"padding: 0 10rpx\">\n                                            <price\n                                                :content=\"\n                                                    item.goods.member_price || item.goods.sell_price\n                                                \"\n                                                :weight=\"500\"\n                                                color=\"#7B3200\"\n                                            >\n                                            </price>\n                                        </view>\n                                    </view>\n                                    <!-- 其他活动价 -->\n                                    <view\n                                        class=\"vip-price flex m-l-10\"\n                                        v-if=\"\n                                            orderInfo.order_type == 1 ||\n                                            orderInfo.order_type == 2 ||\n                                            orderInfo.order_type == 3\n                                        \"\n                                    >\n                                        <view\n                                            class=\"price-name xxs\"\n                                            v-if=\"orderInfo.order_type == 1\"\n                                            >拼团价</view\n                                        >\n                                        <view\n                                            class=\"price-name xxs\"\n                                            v-if=\"orderInfo.order_type == 2\"\n                                            >秒杀价</view\n                                        >\n                                        <view\n                                            class=\"price-name xxs\"\n                                            v-if=\"orderInfo.order_type == 3\"\n                                            >砍价</view\n                                        >\n                                        <view style=\"padding: 0 10rpx\">\n                                            <price\n                                                :content=\"item.goods.sell_price\"\n                                                :weight=\"500\"\n                                                color=\"#7B3200\"\n                                            >\n                                            </price>\n                                        </view>\n                                    </view>\n                                </view>\n\n                                <text class=\"lighter sm\" v-show=\"!!item.goods.goods_num\"\n                                    >x{{ item.goods.goods_num }}</text\n                                >\n                            </view>\n                        </view>\n                    </goods-card>\n                </view>\n            </scroll-view>\n            <view class=\"coupons-footer\">\n                <view class=\"coupons-footer-button\" @tap=\"showDisabled = false\">我知道了</view>\n            </view>\n        </u-popup>\n\n        <!-- 页面状态 -->\n        <page-status :status=\"pageStatus\">\n            <template #error>\n                <u-empty\n                    :text=\"pageErrorMsg\"\n                    src=\"/static/images/empty/order.png\"\n                    :icon-size=\"280\"\n                />\n            </template>\n        </page-status>\n        <!-- 不能购买modal弹框 -->\n        <u-modal\n            :value=\"showModal\"\n            :show-confirm-button=\"false\"\n            :show-title=\"false\"\n            :mask-close-able=\"false\"\n        >\n            <view class=\"modal\">\n                <view class=\"modal-text-title\">很抱歉，购买失败</view>\n                <view class=\"modal-text-content m-t-40 m-b-40\">商品不能购买</view>\n                <button class=\"br60 modal-btn\" size=\"md\" hover-class=\"none\" @tap=\"handledisBuy\">\n                    我知道了\n                </button>\n            </view>\n        </u-modal>\n    </view>\n</template>\n\n<script>\n/**\n * @description 订单结算页\n * @query { Number | OrderTypeEnum } from 订单类型: 0-商品；1-拼团；2-秒杀；3-砍价；4- 虚拟商品。\n * @query { Object } payload 请求数据参数\n * @example { from: OrderTypeEnum['GOODS'], payload: {source: 'buy_now', goods: {goods_num: 1, item_id: 24} }}\n */\n\nimport { apiOrderPlace, apiDeliveryType } from '@/api/order'\nimport { apiSeckillPlace } from '@/api/activity'\nimport { apiGoodsTeamPlace } from '@/api/goods'\nimport { apiBargainSettle } from '@/api/bargain'\nimport { apiCouponGoods } from '@/api/store'\nimport { apiSubscribe } from '@/api/app'\nimport { handleClientEvent } from '@/utils/tools'\nimport {\n    PageStatusEnum,\n    OrderTypeEnum,\n    OrderSourceEnum,\n    PaymentStatusEnum,\n    PayWayEnum\n} from '@/utils/enum'\nimport { nextTick } from 'process'\nimport { apicheckCanBuy } from '@/api/goods'\n\nexport default {\n    name: 'GoodsOrder',\n\n    data() {\n        return {\n            from: '', // 来源页面: 0-商品；1-拼团；2-秒杀；3-砍价。\n            // 页面状态\n            pageStatus: PageStatusEnum['LOADING'],\n            pageErrorMsg: '', // 页面异常信息\n\n            // 配送方式Tabs列表\n            deliveryTypeTabsList: [\n                {\n                    id: 1,\n                    name: '快递发货',\n                    sign: 'express'\n                },\n                {\n                    id: 2,\n                    name: '上门自提',\n                    sign: 'store'\n                }\n            ],\n            deliveryTypeTabsIndex: 0, // 配送方式Tabs索引\n\n            pageQueryPayload: {}, // 承载页面参数\n            // 订单表单\n            orderFrom: {\n                delivery_type: '', // 配送方式: 1-快递发货; 2-门店自提;\n                user_remark: '', // 用户备注\n                coupon_list_id: '', // 优惠券ID\n                address_id: '', // 地址ID 【快递发货】\n                selffetch_shop_id: '', // 自提门店ID 【门店自提】\n                contact: '', // 提货人 【门店自提】\n                mobile: '' // 联系电话 【门店自提】\n            },\n\n            /** S 优惠券 **/\n            showCoupons: false, // 优惠券: 显示|隐藏【弹窗】\n            // 优惠券Tabs列表\n            couponTabsList: [\n                {\n                    sign: 'usable',\n                    name: '可使用优惠券'\n                },\n                {\n                    sign: 'disabled',\n                    name: '不可使用优惠券'\n                }\n            ],\n            couponTabsIndex: 0, // 优惠券Tabs索引\n            // 优惠券信息\n            couponsInfo: {\n                can_use: [],\n                not_can_use: []\n            },\n            couponsActive: {}, // 当前使用优惠券\n            /** E 优惠券 **/\n\n            addressInfo: {}, // 地址信息\n            selffetchStoreInfo: {}, // 自提门店信息\n            orderInfo: {}, // 订单信息\n            orderGoodsList: [], // 订单商品\n            disableGoods: [], //不可下单商品\n            showDisabled: false, //不可下单商品\n            goodsLength: 0,\n            showModal: false //不可下单弹框\n        }\n    },\n\n    computed: {\n        // 过滤订单表单冗余参数\n        orderFormParams() {\n            const from = { ...this.orderFrom }\n            // 根据物流方式过滤\n            switch (from.delivery_type) {\n                case 1:\n                    delete from.selffetch_shop_id\n                    delete from.contact\n                    delete from.mobile\n                    break\n                case 2:\n                    delete from.address_id\n                    break\n            }\n            return from\n        },\n\n        // 根据订单类型扩展订单参数\n        orderExtendParams() {\n            const params = new Object()\n\n            switch (this.from) {\n                // 普通商品\n                case OrderTypeEnum['GOODS']:\n                    break\n                // 拼团商品\n                case OrderTypeEnum['TEAM']:\n                    params.source = OrderSourceEnum['BUY_NOW']\n                    break\n                // 秒杀商品\n                case OrderTypeEnum['SECKILL']:\n                    params.source = OrderSourceEnum['BUY_NOW']\n                    break\n                // 砍价商品\n                case OrderTypeEnum['BARGAIN']:\n                    params.source = OrderSourceEnum['BUY_NOW']\n                    break\n                // 预售商品\n                case OrderTypeEnum['PRESELL']:\n                    params.source = OrderSourceEnum['BUY_NOW']\n                    break\n            }\n\n            return { ...params, order_type: this.from }\n        },\n\n        // 是否营销商品\n        isMarketing() {\n            switch (this.from) {\n                // 普通商品\n                case OrderTypeEnum['VIRTUAL']:\n                case OrderTypeEnum['GOODS']:\n                    return false\n                default:\n                    return true\n            }\n        },\n\n        // 当前配送方式Tab\n        deliveryActive() {\n            return this.deliveryTypeTabsList[this.deliveryTypeTabsIndex]\n        },\n\n        // 当前优惠券Tab\n        couponsTabActive() {\n            return this.couponTabsList[this.couponTabsIndex]\n        }\n    },\n    watch: {\n        //合并不可购买商品和可购商品\n        disableGoods(val) {\n            val.forEach((i) => {\n                this.orderGoodsList.push({ ...i.goods, msg: i.msg })\n            })\n        },\n        immediate: true\n    },\n    methods: {\n        // 初始化配送方式\n        initDeliveryType() {\n            return new Promise((resolve, reject) => {\n                apiDeliveryType()\n                    .then((data) => {\n                        const { express, selffetch } = data\n                        // 订单配送方式ID组\n                        const deliveries = []\n                        // 计入配送方式列表ID组\n                        express.is_express && deliveries.push(1)\n                        selffetch.is_selffetch && deliveries.push(2)\n                        // 过滤配送方式\n                        this.deliveryTypeTabsList = this.deliveryTypeTabsList.filter((item) =>\n                            deliveries.includes(item['id'])\n                        )\n                        this.deliveryTypeTabsList.forEach((item) => {\n                            switch (item.id) {\n                                case 1:\n                                    item.name = express.express_name\n                                    break\n                                case 2:\n                                    item.name = selffetch.selffetch_name\n                                    break\n                            }\n                        })\n                        // 初始化订单表单的配送方式\n                        this.orderFrom.delivery_type = this.deliveryActive['id']\n                        resolve(data)\n                    })\n                    .catch((errMsg) => reject(errMsg ?? '获取不到配送方式'))\n            })\n        },\n\n        // 根据商品类型初始化订单数据\n        initOrderData() {\n            return new Promise((resolve, reject) => {\n                apiOrderPlace({\n                    ...this.orderFormParams,\n                    ...this.pageQueryPayload,\n                    ...this.orderExtendParams,\n                    action: 'settle'\n                })\n                    .then((data) => {\n                        this.addressInfo = data.address\n                        this.orderFrom.address_id = data.address?.id\n                        this.goodsLength = data.goods.length\n                        this.orderGoodsList = data.goods\n                        this.disableGoods = data.goods_disabled\n                        this.orderInfo = data\n                        this.orderFrom.contact = data.selffetch_info.contact\n                        this.orderFrom.mobile = data.selffetch_info.mobile\n                        resolve(data)\n                    })\n                    .catch((errMsg) => reject(errMsg))\n            })\n        },\n\n        /** S 优惠券 **/\n        // 初始化优惠券列表\n        initCouponGoods() {\n            return new Promise((resolve, reject) => {\n                let params = null\n                const { goods, cart_id, source } = this.pageQueryPayload\n\n                // buy_now | cart 处理：请求优惠券列表的参数处理\n                switch (source) {\n                    case OrderSourceEnum['BUY_NOW']:\n                        const goodsItems = goods.map((item) => ({\n                            num: item.goods_num,\n                            item_id: item.item_id\n                        }))\n                        params = { goods: goodsItems, source: 1 }\n                        break\n                    case OrderSourceEnum['CART']:\n                        params = { cart_ids: [...cart_id], source: 2 }\n                        break\n                }\n\n                apiCouponGoods({\n                    ...params\n                })\n                    .then((data) => {\n                        data.can_use.forEach((item) => (item.checked = false))\n                        // 有可用优惠券默认选择第一个\n                        if (data.can_use[0]) {\n                            data.can_use[0].checked = true\n                            this.couponsActive = data.can_use[0]\n                        }\n                        return data\n                    })\n                    .then((data) => {\n                        this.couponsInfo = data\n                        // Tab名称处理（优惠券数量）\n                        this.couponTabsList.forEach((item) => {\n                            switch (item.sign) {\n                                case 'usable':\n                                    item.name = item.name + `(${data.can_use_count})`\n                                    break\n                                case 'disabled':\n                                    item.name = item.name + `(${data.not_can_use_count})`\n                                    break\n                            }\n                        })\n                        resolve(data)\n                    })\n                    .catch((errMsg) => reject(errMsg))\n            })\n        },\n\n        // 更改优惠券\n        changeCouponUse(coupon, value) {\n            this.couponsInfo.can_use.forEach((item) => (item.checked = false))\n            coupon && (coupon.checked = true)\n        },\n\n        // 使用优惠券\n        useCoupon() {\n            this.showCoupons = false\n            const coupon = this.couponsInfo.can_use.find((item) => item.checked)\n            this.couponsActive = coupon || {}\n            this.$set(this.orderFrom, 'coupon_list_id', coupon?.id)\n            this.initOrderData()\n        },\n\n        // 打开优惠券弹窗\n        openCouponsPopup() {\n            if (Object.keys(this.couponsActive).length) {\n                const coupon = this.couponsInfo.can_use.find(\n                    (item) => item.id === this.couponsActive.id\n                )\n                coupon.checked = true\n            }\n        },\n\n        // 关闭优惠券弹窗\n        closeCouponsPopup() {\n            if (!Object.keys(this.couponsActive).length) {\n                this.couponsInfo.can_use.forEach((item) => (item.checked = false))\n            }\n        },\n        /** E 优惠券 **/\n\n        // 更改配送方式\n        async changeDeliveryType(index) {\n            this.deliveryTypeTabsIndex = index\n            this.orderFrom.delivery_type = this.deliveryActive['id']\n            try {\n                const { selffetch_info } = await this.initOrderData()\n                if (selffetch_info.selffetch_shop_id) {\n                    this.orderFrom.selffetch_shop_id = selffetch_info.selffetch_shop_id\n                    this.selffetchStoreInfo = selffetch_info.selffetch_shop\n                }\n            } catch (error) {\n                console.log(error)\n            }\n        },\n\n        // 点击地址选择\n        onAddressSelect() {\n            // 监听全局selectaddress事件\n            uni.$once('changeAddress', (id = this.orderFrom.address_id) => {\n                id && (this.orderFrom.address_id = id)\n                this.initOrderData()\n            })\n\n            this.$Router.push({\n                path: '/pages/address/address',\n                query: {\n                    type: true\n                }\n            })\n        },\n\n        // 点击店铺选择\n        onStoreSelect() {\n            // 监听全局selectaddress事件\n            uni.$once('changeStore', (store) => {\n                this.selffetchStoreInfo = store\n                this.orderFrom.selffetch_shop_id = store.id\n                this.initOrderData()\n            })\n\n            this.$Router.push({\n                path: '/bundle/pages/store_list/store_list'\n            })\n        },\n        // 校验表单数据\n        checkOrder() {\n            const from = { ...this.orderFrom }\n\n            // 根据物流方式过滤\n            switch (from.delivery_type) {\n                case 1:\n                    if (!from.address_id) {\n                        throw new Error('请选择送货地址')\n                    }\n                    break\n                case 2:\n                    if (!(from.selffetch_shop_id && from.contact && from.mobile.length == 11)) {\n                        throw new Error('请完善自提点信息')\n                    }\n                    break\n            }\n        },\n        // 点击提交订单\n        onSubmitOrder() {\n            // 可购买商品为0时直接返回\n            if (this.goodsLength == 0) {\n                return\n            }\n            if (\n                this.orderFrom.delivery_type == 4 &&\n                !this.orderFrom.address_id &&\n                this.deliveryActive['sign'] == 'express' &&\n                this.orderInfo.is_address != 0\n            ) {\n                return this.$toast({\n                    title: '请选择收货地址'\n                })\n            }\n            try {\n                this.checkOrder()\n            } catch (error) {\n                return this.$toast({\n                    title: error.message\n                })\n            }\n            uni.showModal({\n                title: '温馨提示',\n                content: '是否确认下单?',\n                confirmColor: this.themeColor,\n                success: async ({ confirm }) => {\n                    try {\n                        if (!confirm) throw '订单取消'\n\n                        // 微信订阅消息\n                        try {\n                            // #ifdef MP-WEIXIN\n                            await this.handleSubscribeMP_WEIXIN()\n                            // #endif\n                        } catch (errMsg) {\n                            console.log('SUBSCRIBE_ERROR_MSG:', errMsg)\n                        }\n                        // 下单处理\n                        const res = await this.handlePlaceOrder()\n                        console.log(res)\n                    } catch (errMsg) {\n                        console.log('ORDER_ERROR_MSG:', errMsg)\n                        if (errMsg == '提交的商品已不能购买，请重新选择商品') {\n                            this.showModal = true\n                        } else if (errMsg == '自提门店不能为空') {\n                            this.$toast({ title: '请选择自提门店' })\n                        }\n                    }\n                }\n            })\n        },\n\n        // 处理：微信订阅消息\n        handleSubscribeMP_WEIXIN() {\n            return new Promise((resolve, reject) => {\n                apiSubscribe()\n                    .then((data) => {\n                        if (!data.length) reject('暂无可订阅信息')\n                        uni.requestSubscribeMessage({\n                            tmplIds: data,\n                            success(res) {\n                                resolve(res)\n                            },\n                            fail(err) {\n                                reject('订阅失败')\n                            }\n                        })\n                    })\n                    .catch(() => reject('订阅获取失败'))\n            })\n        },\n\n        // 下单处理\n        handlePlaceOrder() {\n            return new Promise((resolve, reject) => {\n                apiOrderPlace({\n                    ...this.orderFormParams,\n                    ...this.pageQueryPayload,\n                    ...this.orderExtendParams,\n                    action: 'buy'\n                })\n                    .then((data) => {\n                        // 监听全局duringPayment事件\n                        uni.$once('duringPayment', (data) => {\n                            this.handlePayResult(data)\n                        })\n                        return data\n                    })\n                    .then(({ type, order_id }) => {\n                        // 去支付\n                        this.$Router.replace({\n                            path: `/pages/payment/payment`,\n                            query: {\n                                from: type,\n                                order_id\n                            }\n                        })\n                        resolve(order_id)\n                    })\n                    .catch((errMsg) => reject(errMsg))\n            })\n        },\n\n        // 支付结果处理\n        handlePayResult({ result, order_id }) {\n            switch (result) {\n                case PaymentStatusEnum['SUCCESS']:\n                case PaymentStatusEnum['FAIL']:\n                    this.$Router.replace({\n                        path: '/pages/payment_result/payment_result',\n                        query: { order_id, from: 'order' }\n                    })\n                    break\n                case PaymentStatusEnum['CLOSE']:\n                    this.$Router.push({\n                        path: '/pages/payment_result/payment_result',\n                        query: { order_id, from: 'order' }\n                    })\n                    break\n            }\n        },\n        //不可购买弹框\n        handledisBuy() {\n            this.$Router.replaceAll({\n                path: '/pages/shop_cart/shop_cart'\n            })\n        }\n    },\n\n    async onLoad() {\n        const options = this.$Route.query\n        console.log(options)\n        // 初始化页面\n        try {\n            // 初始化页面参数\n            this.from = options.from\n            this.pageQueryPayload = options.payload\n            this.orderFrom.address_id = options.address_id\n            // 初始化配送方式\n            if (options.from == 4) {\n                this.orderFrom.delivery_type = 4\n            } else {\n                await this.initDeliveryType()\n            }\n            // 初始化优惠券数据(营销商品不可使用)\n            !this.isMarketing && (await this.initCouponGoods())\n            // 默认选择可用优惠券\n            this.$set(this.orderFrom, 'coupon_list_id', this.couponsInfo?.can_use[0]?.id)\n            // 初始化页面数据\n            await this.initOrderData()\n\n            this.pageStatus = PageStatusEnum['NORMAL']\n        } catch (errMsg) {\n            this.pageErrorMsg = errMsg\n            this.pageStatus = PageStatusEnum['ERROR']\n            console.log('页面数据初始化失败', errMsg)\n        }\n    },\n\n    onUnload() {\n        uni.$off(['changeStore', 'changeAddress'])\n    }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n// Page style\n.goods-order {\n    padding: 0 20rpx calc(100rpx + 20rpx + constant(safe-area-inset-bottom)) 20rpx;\n    padding: 0 20rpx calc(100rpx + 20rpx + env(safe-area-inset-bottom)) 20rpx;\n\n    // 卡片\n    .contain {\n        margin-top: 20rpx;\n        border-radius: 7px;\n        background-color: #ffffff;\n        overflow: hidden;\n    }\n\n    // 单元格\n    .cell {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        font-size: $-font-size-nr;\n        color: $-color-black;\n\n        &-label {\n            width: 130rpx;\n        }\n\n        &-content {\n            flex: 1;\n            display: flex;\n            align-items: center;\n            justify-content: flex-end;\n        }\n    }\n\n    // 初始化复选框的外边距\n    .u-checkbox {\n        ::v-deep .u-checkbox__label {\n            margin: 0;\n        }\n    }\n}\n\n// 配送方式\n.delivery {\n    &-tabs {\n        border-bottom: $-solid-border;\n    }\n\n    &-contain {\n        // border-top: $-solid-border;\n    }\n}\n\n// 门店自提表单\n.store-from {\n    padding-left: 20rpx;\n    font-size: $-font-size-nr;\n\n    &-item {\n        display: flex;\n        align-items: center;\n        height: 100rpx;\n        padding-right: 20rpx;\n\n        &:nth-child(n + 2) {\n            border-top: $-dashed-border;\n        }\n    }\n}\n\n// 商品\n.goods {\n    &-item {\n        position: relative;\n\n        &:nth-child(n + 2)::before {\n            position: absolute;\n            left: 0;\n            right: 0;\n            top: 0;\n            display: block;\n            content: '';\n            border-top: $-solid-border;\n            margin-left: 20rpx;\n        }\n\n        &-widget {\n            padding: 0 20rpx 0 calc((20rpx * 2) + 160rpx);\n\n            .delivery-tag {\n                display: inline-block;\n                padding: 4rpx 15rpx;\n                margin-bottom: 20rpx;\n                border-radius: 60px;\n                font-size: $-font-size-xxs;\n                background-color: #f4f4f4;\n                color: $-color-muted;\n            }\n        }\n    }\n\n    // 会员价\n    .vip-price {\n        margin-top: 5rpx;\n        background-color: #ffe9ba;\n        color: #ffd4b7;\n        line-height: 36rpx;\n        border-radius: 6rpx;\n        overflow: hidden;\n\n        .price-name {\n            background-color: #101010;\n            padding: 3rpx 12rpx;\n            position: relative;\n            overflow: hidden;\n\n            &::after {\n                content: '';\n                display: block;\n                width: 20rpx;\n                height: 20rpx;\n                position: absolute;\n                right: -15rpx;\n                background-color: #ffe9ba;\n                border-radius: 50%;\n                top: 50%;\n                transform: translateY(-50%);\n                box-sizing: border-box;\n            }\n        }\n    }\n}\n\n// 留言\n.remark {\n    height: 100rpx;\n    padding: 0 20rpx;\n}\n\n// 优惠\n.discounts {\n    padding-left: 20rpx;\n\n    &-item {\n        height: 100rpx;\n        padding-right: 20rpx;\n\n        &:nth-child(n + 2) {\n            border-top: $-dashed-border;\n        }\n    }\n}\n\n// 订单清算\n.clearing {\n    padding: 20rpx;\n\n    &-item {\n        height: 70rpx;\n    }\n}\n\n// 订单功能区\n.operational {\n    box-sizing: border-box;\n    position: fixed;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    z-index: 100;\n    height: calc(100rpx + constant(safe-area-inset-bottom));\n    height: calc(100rpx + env(safe-area-inset-bottom));\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 0 20rpx constant(safe-area-inset-bottom) 20rpx;\n    padding: 0 20rpx env(safe-area-inset-bottom) 20rpx;\n    border-top: $-solid-border;\n    background-color: #ffffff;\n\n    .order-amount {\n        font-size: &-font-size-nr;\n        color: $-color-normal;\n    }\n\n    &-button {\n        padding: 16rpx 45rpx;\n        border-radius: 60px;\n        font-size: $-font-size-md;\n        @include background_linear() color: #ffffff;\n    }\n}\n.goods-disable {\n    position: fixed;\n    left: 0;\n    right: 0;\n    bottom: calc(100rpx + constant(safe-area-inset-bottom));\n    bottom: calc(100rpx + env(safe-area-inset-bottom));\n    z-index: 100;\n    background-color: #ffffff;\n    height: 86rpx;\n    padding: 10rpx 20rpx;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    .text {\n        @include font_color();\n    }\n    .image {\n        height: 50rpx;\n        width: 50rpx;\n    }\n}\n// 优惠券【弹窗】\n.coupons {\n    background-color: #f6f6f6;\n\n    &-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        height: 100rpx;\n        padding: 0 30rpx;\n        font-weight: 500;\n        font-size: $-font-size-md;\n        background-color: #ffffff;\n    }\n\n    &-main {\n        &__tabs {\n            border-top: $-solid-border;\n        }\n\n        &__contain {\n            // margin-top: 20rpx;\n            padding: 0 20rpx;\n        }\n\n        .coupons-item {\n            margin-top: 20rpx;\n        }\n    }\n\n    &-footer {\n        display: flex;\n        align-items: center;\n        padding: 0 20rpx;\n        height: 100rpx;\n        background-color: #ffffff;\n\n        &-button {\n            flex: 1;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            height: 82rpx;\n            border-radius: 60px;\n            font-size: $-font-size-lg;\n            @include background_color();\n            color: #ffffff;\n        }\n    }\n}\n.red {\n    color: red;\n}\n.modal {\n    padding: 50rpx 0;\n    &-text-title {\n        text-align: center;\n        font-size: large;\n        font-weight: 500;\n    }\n    &-text-content {\n        text-align: center;\n    }\n}\n.modal-btn {\n    @include background_color();\n    color: #fff;\n    width: 80%;\n    margin: 0 auto;\n}\n.skuline {\n    -webkit-line-clamp: 1;\n    overflow: hidden;\n    word-break: break-all;\n    text-overflow: ellipsis;\n    display: -webkit-box; // 弹性伸缩盒\n    -webkit-box-orient: vertical; // 设置伸缩盒子元素排列方式\n}\n</style>\n","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./goods_order.vue?vue&type=style&index=0&id=db6a795c&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./goods_order.vue?vue&type=style&index=0&id=db6a795c&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1733935394990\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}