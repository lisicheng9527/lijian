{"version":3,"sources":["uni-app:///main.js","webpack:////Users/lisicheng/project/lijian/bundle/pages/service/service.vue?8a46","webpack:////Users/lisicheng/project/lijian/bundle/pages/service/service.vue?61c4","webpack:////Users/lisicheng/project/lijian/bundle/pages/service/service.vue?1de8","webpack:////Users/lisicheng/project/lijian/bundle/pages/service/service.vue?463c","uni-app:///bundle/pages/service/service.vue","webpack:////Users/lisicheng/project/lijian/bundle/pages/service/service.vue?cf7e","webpack:////Users/lisicheng/project/lijian/bundle/pages/service/service.vue?c2c2"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","components","emoji","data","pageStatus","scrollTop","intoView","page","msg","socket","kefu","showEmoji","recoreds","errorMsg","goodsInfo","isError","showGoods","showIndex","computed","timeFormat","index","item","timeFmt","replaceEmoji","watch","methods","init","token","type","terminal","showTips","uni","title","content","success","getConfig","then","catch","getData","res","console","getGoods","goods_id","activity_id","previewImage","urls","uploadFile","count","error","file","sendText","sendGoods","getChatRecord","page_no","toid","send","event","msg_type","to_id","to_type","handleEmojiShow","setTimeout","scrollToupper","scrollToBottom","scrollToItem","handleEmojiInput","chatEvent","errorEvent","loginEvent","kefu_id","transferEvent","setTitle","onLoad","onUnload","onReady"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,gBAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAoH;AACpH;AAC2D;AACL;AACc;;;AAGpE;AACgN;AAChN,gBAAgB,iNAAU;AAC1B,EAAE,6EAAM;AACR,EAAE,kFAAM;AACR,EAAE,2FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,sFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,2PAEN;AACP,KAAK;AACL;AACA,aAAa,uKAEN;AACP,KAAK;AACL;AACA,aAAa,yOAEN;AACP,KAAK;AACL;AACA,aAAa,8OAEN;AACP,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AC7FA;AAAA;AAAA;AAAA;AAAq0B,CAAgB,qyBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;ACsJz1B;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eAEA;EACAC;IACAC;EACA;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;IACA;EACA;EACAC;IACA;IACAC;MAAA;MACA;QACA;QACA,IACAC,SACAC,8EACA,iBACA;UACAC;QACA;QAEA;MACA;IACA;IACA;IACAC;MACA;QAAA;MAAA;IACA;EACA;EACAC;IACAd;MACA;QACA;MACA;IACA;EACA;EACAe;IACA;IACAC;MAAA;MACA;QACAC;QACAC;QACAC;MACA;MACA;QACA;MACA;MACA;QACA;QACA;MACA;MACA;QACA;UACA;YACA;YACA;UACA;YACA;YACA;UACA;YACA;YACA;UACA;YACA;YACA;QAAA;MAEA;MACA;QACA;MACA;IACA;IAEAC;MAAA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACAC;QACAC;QACAC;QACAC;UACA;YACA;UACA;YACA;UACA;QACA;MACA;IACA;IACAC;MACA,kCACAC;QACA;MACA,GACAC;QACA;MACA;IACA;IACA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA;gBAAA,OAEA;cAAA;gBAAAC;gBAAA;gBAAA,OACA;cAAA;gBACA;gBACA;gBAAA,IACA;kBAAA;kBAAA;gBAAA;gBACA;gBAAA;cAAA;gBAGA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAC;gBAEA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IACAC;MAAA;MACA;QAAAC;QAAAd;QAAAe;MACA;MACA;QACAD;QACAd;QACAe;MACA;QACA;QACA;UACA;QACA;MACA;IACA;IACA;IACAC;MACAb;QACAc;MACA;IACA;IAEA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA,OACAf;kBACAgB;gBACA;cAAA;gBAAA;gBAAA;gBAFAC;gBAAAd;gBAAA,KAGAc;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBAGAjB;kBACAC;gBACA;gBAAA;gBAAA;gBAAA,OAEA;cAAA;gBAAAiB;gBACA;gBACAlB;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEA;kBACAC;gBACA;gBACAD;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IACA;IACAmB;MACA;MACA;MACA;IACA;IACA;IACAC;MACA;MACA;QAAAT;QAAAd;QAAAe;MACA,UACA;QACAD;QACAd;QACAe;MACA,GACA,EACA;IACA;IAEA;IACAS;MAAA;MAAA;QAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACA7C;gBAAA,MACAH;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA,OACA;kBACAiD;gBACA;cAAA;gBAFAlD;gBAGAmD;gBACA;gBACA5C;gBACA;gBACA;gBACA;kBACA4C;kBACA;gBACA;gBAEA;gBACA;kBACA;oBACA;kBACA;kBACA;kBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IACA;IACAC;MACA;QACAC;QACArD;UACAK;UACAiD;UAAA;UACAC;UAAA;UACAC;QACA;MACA;IACA;IACA;IACAC;MAAA;MACA;MACA;MACAC;QACA;MACA;IACA;IACAC;MACA;IACA;IACAC;MAAA;MACA;MACA;QACA;MACA;IACA;IACAC;MAAA;MACA;MACA;QACA;MACA;IACA;IAEAC;MACA;IACA;IACAC;MAAA;MACA;MACA;QACAnC;UACAG;YACAM;UACA;QACA;MACA;MACA;MACA;QACA;UACA;YACA;UACA;QACA;MACA;IACA;IACA2B;MAAA;MACA;MACA;MACA;QACA;MACA;IACA;IACAC;MACA;MACA;QACAZ;QACArD;UACAkE;QACA;MACA;IACA;IACAC;MACA;IACA;IACAC;MACAxC;QACAC;MACA;IACA;EACA;EACAwC;IAAA;IAAA;MAAA;QAAA;UAAA;YAAA;cACA;cACA;cACA;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA;EACA;EACAC;IACA;EACA;EACAC;AACA;AAAA,2B;;;;;;;;;;;;;ACtdA;AAAA;AAAA;AAAA;AAAoiD,CAAgB,o6CAAG,EAAC,C;;;;;;;;;;;ACAxjD;AACA,kBAAkB;AAClB,OAAO,KAAU,EAAE,kBAKd","file":"bundle/pages/service/service.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './bundle/pages/service/service.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./service.vue?vue&type=template&id=3378875e&\"\nvar renderjs\nimport script from \"./service.vue?vue&type=script&lang=js&\"\nexport * from \"./service.vue?vue&type=script&lang=js&\"\nimport style0 from \"./service.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"bundle/pages/service/service.vue\"\nexport default component.exports","export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./service.vue?vue&type=template&id=3378875e&\"","var components\ntry {\n  components = {\n    uLoading: function () {\n      return import(\n        /* webpackChunkName: \"components/uview-ui/components/u-loading/u-loading\" */ \"@/components/uview-ui/components/u-loading/u-loading.vue\"\n      )\n    },\n    price: function () {\n      return import(\n        /* webpackChunkName: \"components/price/price\" */ \"@/components/price/price.vue\"\n      )\n    },\n    uIcon: function () {\n      return import(\n        /* webpackChunkName: \"components/uview-ui/components/u-icon/u-icon\" */ \"@/components/uview-ui/components/u-icon/u-icon.vue\"\n      )\n    },\n    uImage: function () {\n      return import(\n        /* webpackChunkName: \"components/uview-ui/components/u-image/u-image\" */ \"@/components/uview-ui/components/u-image/u-image.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.recoreds, function (item, index) {\n    var $orig = _vm.__get_orig(item)\n    var m0 = item.type == 1 ? _vm.timeFormat(item, index) : null\n    var m1 = item.type == 1 && m0 ? _vm.timeFormat(item, index) : null\n    var m2 = item.type == 1 ? _vm.$getImageUri(item.from_avatar) : null\n    var m3 =\n      item.type == 1 && item.msg_type == 1 ? _vm.replaceEmoji(item.msg) : null\n    var m4 =\n      item.type == 1 && item.msg_type == 2 ? _vm.$getImageUri(item.msg) : null\n    var m5 =\n      item.type == 1 && item.msg_type == 2 ? _vm.$getImageUri(item.msg) : null\n    var m6 =\n      item.type == 1 && item.msg_type == 3\n        ? _vm.$getImageUri(item.goods.image)\n        : null\n    return {\n      $orig: $orig,\n      m0: m0,\n      m1: m1,\n      m2: m2,\n      m3: m3,\n      m4: m4,\n      m5: m5,\n      m6: m6,\n    }\n  })\n  if (!_vm._isMounted) {\n    _vm.e0 = function ($event) {\n      _vm.showEmoji = false\n    }\n    _vm.e1 = function ($event) {\n      _vm.showGoods = false\n    }\n    _vm.e2 = function ($event) {\n      _vm.showGoods = false\n    }\n  }\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./service.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./service.vue?vue&type=script&lang=js&\"","<template>\n    <view :class=\"themeName\" style=\"height: 100%\">\n        <view class=\"chat flex-col\">\n            <view class=\"content\" @tap=\"showEmoji = false\">\n                <scroll-view\n                    style=\"height: 100%\"\n                    :scroll-y=\"true\"\n                    :scroll-top=\"scrollTop\"\n                    :scroll-into-view=\"intoView\"\n                    @scrolltoupper=\"scrollToupper\"\n                >\n                    <view class=\"loading flex row-center\" v-if=\"pageStatus == 'loading'\">\n                        <u-loading mode=\"flower\" size=\"40\"></u-loading>\n                    </view>\n                    <view class=\"chat-lists\">\n                        <view\n                            class=\"chat-item\"\n                            v-for=\"(item, index) in recoreds\"\n                            :id=\"`chat-item_${item.id}`\"\n                            :key=\"item.id\"\n                            :class=\"{\n                                right: item.from_type == 'user',\n                                left: item.from_type == 'kefu',\n                                visibility: showIndex > index\n                            }\"\n                        >\n                            <!-- 普通聊天记录 -->\n                            <template v-if=\"item.type == 1\">\n                                <!-- 时间 -->\n                                <view\n                                    class=\"text-center m-b-30 white\"\n                                    v-if=\"timeFormat(item, index)\"\n                                >\n                                    <view class=\"chat-tips xs\">{{ timeFormat(item, index) }}</view>\n                                </view>\n                                <view class=\"chat-info\">\n                                    <image class=\"avatar\" :src=\"$getImageUri(item.from_avatar)\">\n                                    </image>\n                                    <!-- 文本 -->\n                                    <view\n                                        class=\"text-box\"\n                                        v-if=\"item.msg_type == 1\"\n                                        v-html=\"replaceEmoji(item.msg)\"\n                                    >\n                                    </view>\n                                    <!-- 图片 -->\n                                    <view class=\"image-box\" v-if=\"item.msg_type == 2\">\n                                        <image\n                                            class=\"image\"\n                                            mode=\"widthFix\"\n                                            :src=\"$getImageUri(item.msg)\"\n                                            @tap=\"previewImage($getImageUri(item.msg))\"\n                                        >\n                                        </image>\n                                    </view>\n                                    <!-- 商品 -->\n                                    <view class=\"goods m-r-20 goods-box\" v-if=\"item.msg_type == 3\">\n                                        <view class=\"goods-img m-r-20\">\n                                            <image\n                                                style=\"width: 140rpx; height: 140rpx\"\n                                                :src=\"$getImageUri(item.goods.image)\"\n                                            >\n                                            </image>\n                                        </view>\n                                        <view class=\"goods-info flex-1\">\n                                            <view class=\"line-2\">\n                                                {{ item.goods.name }}\n                                            </view>\n                                            <view class=\"flex m-t-10 row-between\">\n                                                <price\n                                                    :content=\"item.goods.min_price\"\n                                                    main-size=\"38rpx\"\n                                                    minor-size=\"26rpx\"\n                                                    :color=\"themeColor\"\n                                                />\n                                            </view>\n                                        </view>\n                                    </view>\n                                </view>\n                            </template>\n                            <!-- 通知类型记录 -->\n                            <template v-else>\n                                <view class=\"text-center white\">\n                                    <view class=\"muted xs\">{{ item.msg }}</view>\n                                </view>\n                            </template>\n                        </view>\n                    </view>\n                    <view class=\"error\" v-if=\"isError\">\n                        <view class=\"error-msg text-center xs\">{{ errorMsg }}</view>\n                    </view>\n                    <view id=\"bottom\"></view>\n                </scroll-view>\n            </view>\n            <view class=\"footer\" @tap=\"showGoods = false\">\n                <view class=\"footer-input flex\">\n                    <view class=\"album\" @tap=\"uploadFile\">\n                        <image class=\"icon\" src=\"@/bundle/static/images/icon_album.png\"></image>\n                    </view>\n                    <view class=\"input-contain flex\">\n                        <input\n                            v-model=\"msg\"\n                            class=\"text-area\"\n                            confirm-type=\"send\"\n                            maxlength=\"-1\"\n                            @focus=\"scrollToBottom\"\n                            @confirm=\"sendText\"\n                        />\n                        <image\n                            class=\"icon\"\n                            src=\"@/bundle/static/images/icon_emoji.png\"\n                            @tap=\"handleEmojiShow\"\n                        ></image>\n                    </view>\n                    <button size=\"sm\" class=\"send-btn\" @tap=\"sendText\">发送</button>\n                </view>\n                <view class=\"emoji-wrap\" :class=\"{ 'emoji-show': showEmoji }\">\n                    <scroll-view style=\"height: 100%\" scroll-y=\"true\">\n                        <emoji @input=\"handleEmojiInput\"></emoji>\n                    </scroll-view>\n                </view>\n            </view>\n\n            <view class=\"goods\" v-if=\"showGoods\">\n                <view class=\"close\" @tap=\"showGoods = false\">\n                    <u-icon name=\"close-circle-fill\" color=\"#ccc\" size=\"40\"></u-icon>\n                </view>\n                <view class=\"goods-img m-r-20\">\n                    <u-image width=\"140rpx\" height=\"140rpx\" :src=\"goodsInfo.image\"></u-image>\n                </view>\n                <view class=\"goods-info flex-1\">\n                    <view class=\"line-2\">\n                        {{ goodsInfo.name }}\n                    </view>\n                    <view class=\"flex m-t-10 row-between\">\n                        <price\n                            :content=\"goodsInfo.min_price\"\n                            main-size=\"38rpx\"\n                            minor-size=\"26rpx\"\n                            :color=\"themeColor\"\n                        />\n                        <view class=\"send-btn\" @tap=\"sendGoods\">发送链接</view>\n                    </view>\n                </view>\n            </view>\n        </view>\n    </view>\n</template>\n\n<script>\nimport Socket from '@/utils/socket'\nimport { apiChatRecord, apiChatConfig, apiChatGoods } from '@/api/user'\nimport { uploadFile, getRect, debounce } from '@/utils/tools'\nimport { timeFormatChat } from '@/utils/date'\nimport { mapMutations } from 'vuex'\nimport emoji from '@/bundle/components/emoji/emoji.vue'\nexport default {\n    components: {\n        emoji\n    },\n    data() {\n        return {\n            pageStatus: 'loading',\n            scrollTop: '',\n            intoView: '',\n            page: 1,\n            msg: '',\n            socket: {},\n            kefu: {},\n            showEmoji: false,\n            recoreds: [],\n            errorMsg: '',\n            goodsInfo: {},\n            isError: false,\n            showGoods: false,\n            showIndex: -1\n        }\n    },\n    computed: {\n        // 设置记录\n        timeFormat() {\n            return (item, index) => {\n                let timeFmt = timeFormatChat(item.create_time_stamp)\n                if (\n                    index &&\n                    item.create_time_stamp - this.recoreds[index - 1].create_time_stamp < 300 &&\n                    !item.show_time\n                ) {\n                    timeFmt = ''\n                }\n\n                return timeFmt\n            }\n        },\n        // 表情转换\n        replaceEmoji() {\n            return (str) => str.replace(/\\[em-([a-z_]+)\\]/g, `<span class=\"em em-$1\"></span>`)\n        }\n    },\n    watch: {\n        kefu(val) {\n            if (val.id) {\n                this.setTitle(val.nickname)\n            }\n        }\n    },\n    methods: {\n        // 初始化\n        init() {\n            this.socket = new Socket(this.appConfig.ws_domain, {\n                token: this.$store.getters.token,\n                type: 'user',\n                terminal: this.$store.state.app.client\n            })\n            this.socket.addEvent('connect', () => {\n                this.setTitle('连接中...')\n            })\n            this.socket.addEvent('open', () => {\n                this.setTitle(this.kefu.nickname)\n                this.isError = false\n            })\n            this.socket.addEvent('message', (data) => {\n                switch (data.event) {\n                    case 'login':\n                        this.loginEvent(data.data)\n                        break\n                    case 'chat':\n                        this.chatEvent(data.data)\n                        break\n                    case 'transfer':\n                        this.transferEvent(data.data)\n                        break\n                    case 'error':\n                        this.errorEvent(data.data)\n                        break\n                }\n            })\n            this.socket.addEvent('error', (data) => {\n                this.setTitle('连接失败')\n            })\n        },\n\n        showTips(msg) {\n            // if (!msg) {\n            //     setTimeout(() => {\n            //         this.$Router.replace({\n            //             path: `/bundle/pages/artificial_service/artificial_service`\n            //         })\n            //     }, 600)\n            //     return\n            // }\n            uni.showModal({\n                title: '温馨提示',\n                content: '客服未配置正确，请稍后再试',\n                success: (res) => {\n                    if (res.confirm) {\n                        this.$Router.back()\n                    } else if (res.cancel) {\n                        this.$Router.back()\n                    }\n                }\n            })\n        },\n        getConfig() {\n            return apiChatConfig()\n                .then((res) => {\n                    return Promise.resolve(res)\n                })\n                .catch((res) => {\n                    return Promise.reject(res)\n                })\n        },\n        // 获取数据\n        async getData() {\n            try {\n                const res = await this.getConfig()\n                await this.getChatRecord()\n                this.getGoods()\n                this.scrollToBottom()\n                if (!this.kefu.id) {\n                    this.setTitle('客服不在线')\n                    return\n                }\n                this.socket.connect()\n            } catch (e) {\n                console.log('err=>系统客服异常', e)\n\n                this.showTips(e)\n            }\n        },\n        getGoods() {\n            const { goods_id, type, activity_id } = this.$Route.query\n            if (!goods_id) return\n            apiChatGoods({\n                goods_id,\n                type,\n                activity_id\n            }).then((res) => {\n                this.goodsInfo = res\n                if (this.kefu.id) {\n                    this.showGoods = true\n                }\n            })\n        },\n        // 图片预览\n        previewImage(url) {\n            uni.previewImage({\n                urls: [url]\n            })\n        },\n\n        // 上传图片\n        async uploadFile() {\n            const [error, success] = await uni.chooseImage({\n                count: 1\n            })\n            if (error) {\n                return\n            }\n            uni.showLoading({\n                title: '上传中...'\n            })\n            try {\n                const file = await uploadFile(success.tempFilePaths[0])\n                this.send(file.url, 2)\n                uni.hideLoading()\n            } catch (e) {\n                this.$toast({\n                    title: '上传失败，请稍后再试'\n                })\n                uni.hideLoading()\n            }\n        },\n        // 发送文本\n        sendText() {\n            if (!this.msg) return\n            this.send(this.msg, 1)\n            this.msg = ''\n        },\n        // 发送商品\n        sendGoods() {\n            this.showGoods = false\n            const { goods_id, type, activity_id } = this.$Route.query\n            this.send(\n                {\n                    goods_id,\n                    type,\n                    activity_id\n                },\n                3\n            )\n        },\n\n        // 获取聊天记录\n        async getChatRecord() {\n            const { page, pageStatus } = this\n            if (pageStatus == 'finish') return\n            const data = await apiChatRecord({\n                page_no: page\n            })\n            let toid = 0\n            this.page++\n            const { kefu, record } = data\n            this.kefu = kefu\n            this.showIndex = record.lists.length\n            if (this.recoreds.length) {\n                toid = this.recoreds[0].id\n                this.recoreds[0].show_time = true\n            }\n\n            this.recoreds.unshift(...record.lists)\n            this.$nextTick(() => {\n                if (!record.more) {\n                    this.pageStatus = 'finish'\n                }\n                this.scrollToItem(toid)\n                this.showIndex = -1\n            })\n        },\n        // 发送消息\n        send(msg, type) {\n            this.socket.send({\n                event: 'chat',\n                data: {\n                    msg,\n                    msg_type: type, // 暂定 1=>文本；2=>图片；3=>表情\n                    to_id: this.kefu.id, // 接收人id；客服发给用户则为user_id, 用户发给客服则为kefu_id\n                    to_type: 'kefu'\n                }\n            })\n        },\n        // 显示、隐藏表情库\n        handleEmojiShow() {\n            this.showEmoji = !this.showEmoji\n            if (!this.showEmoji) return\n            setTimeout(() => {\n                this.scrollToBottom()\n            }, 300)\n        },\n        scrollToupper() {\n            this.getChatRecord()\n        },\n        scrollToBottom() {\n            this.intoView = 'bottom'\n            this.$nextTick(() => {\n                this.intoView = ''\n            })\n        },\n        scrollToItem(id) {\n            this.intoView = `chat-item_${id}`\n            this.$nextTick(() => {\n                this.intoView = ''\n            })\n        },\n\n        handleEmojiInput(val) {\n            this.msg = this.msg + val\n        },\n        chatEvent(data) {\n            this.isError = false\n            if (data.from_type == 'kefu') {\n                uni.vibrateLong({\n                    success: function () {\n                        console.log('success')\n                    }\n                })\n            }\n            this.recoreds.push(data)\n            this.$nextTick(() => {\n                getRect('#bottom').then((res) => {\n                    if (res.bottom < 1000) {\n                        this.scrollToItem(data.id)\n                    }\n                })\n            })\n        },\n        errorEvent(data) {\n            this.errorMsg = data.msg\n            this.isError = true\n            this.$nextTick(() => {\n                this.scrollToBottom()\n            })\n        },\n        loginEvent(data) {\n            // 登录成功，发送用户上线通知\n            this.socket.send({\n                event: 'user_online',\n                data: {\n                    kefu_id: this.kefu.id\n                }\n            })\n        },\n        transferEvent(data) {\n            this.kefu = data\n        },\n        setTitle(title) {\n            uni.setNavigationBarTitle({\n                title\n            })\n        }\n    },\n    async onLoad() {\n        this.scrollToupper = debounce(this.scrollToupper, 500, this)\n        this.init()\n        this.getData()\n    },\n    onUnload() {\n        this.socket.close()\n    },\n    onReady() {}\n}\n</script>\n\n<style lang=\"scss\">\npage {\n    padding: 0;\n    height: 100%;\n}\n\n.chat {\n    height: 100%;\n\n    .goods {\n        display: flex;\n        position: fixed;\n        width: 600rpx;\n        right: 20rpx;\n        bottom: calc(120rpx + env(safe-area-inset-bottom));\n        border-radius: 14rpx;\n        background: #fff;\n        padding: 20rpx;\n\n        .close {\n            position: absolute;\n            left: -20rpx;\n            top: -20rpx;\n        }\n\n        .send-btn {\n            padding: 8rpx 22rpx;\n        }\n    }\n\n    .content {\n        transition: all 0.3s;\n        flex: 1;\n        min-height: 0;\n\n        .loading {\n            padding: 20rpx;\n            height: 40px;\n        }\n\n        .chat-lists {\n            padding: 0 20rpx 30rpx;\n            overflow: hidden;\n            position: relative;\n\n            .chat-tips {\n                padding: 4rpx 20rpx;\n                border-radius: 21rpx;\n                display: inline-block;\n                text-align: center;\n                background-color: rgba(0, 0, 0, 0.2);\n            }\n\n            .chat-item {\n                padding-top: 30rpx;\n\n                &.visibility {\n                    visibility: hidden;\n                }\n\n                .chat-info {\n                    display: flex;\n                    align-items: flex-start;\n                }\n\n                &.right {\n                    .chat-info {\n                        flex-direction: row-reverse;\n\n                        .text-box {\n                            @include background_color();\n                            color: #fff;\n                        }\n                    }\n                }\n\n                .avatar {\n                    width: 78rpx;\n                    height: 78rpx;\n                    border-radius: 14rpx;\n                    flex: none;\n                }\n\n                .text-box {\n                    max-width: 500rpx;\n                    min-width: 80rpx;\n                    background-color: #fff;\n                    border-radius: 14rpx;\n                    padding: 16rpx 20rpx;\n                    margin: 0 20rpx;\n                    word-break: break-word;\n                    line-height: 40rpx;\n                    white-space: pre-wrap;\n                }\n\n                .image-box {\n                    max-width: 300rpx;\n                    margin: 0 20rpx;\n\n                    .image {\n                        max-width: 100%;\n                    }\n                }\n\n                .goods-box {\n                    position: static;\n                    width: 510rpx;\n                }\n            }\n        }\n    }\n\n    .error {\n        padding: 0 30rpx 30rpx;\n\n        .error-msg {\n            color: #bbb;\n            word-break: break-word;\n        }\n    }\n\n    .footer {\n        background: #f2f2f2;\n        padding-bottom: env(safe-area-inset-bottom);\n\n        .footer-input {\n            height: 100rpx;\n            padding: 0 20rpx;\n\n            .icon {\n                width: 52rpx;\n                height: 52rpx;\n            }\n\n            .input-contain {\n                margin: 0 20rpx;\n                background-color: #fff;\n                height: 68rpx;\n                border-radius: 60rpx;\n                flex: 1;\n                overflow: hidden;\n                padding: 0 10rpx 0 30rpx;\n\n                .text-area {\n                    flex: 1;\n                    height: 100rpx;\n                    word-break: break-all;\n                }\n            }\n        }\n    }\n\n    .emoji-wrap {\n        height: 0;\n        transition: all 0.3s;\n\n        &.emoji-show {\n            height: 200px;\n        }\n    }\n\n    .send-btn {\n        padding: 0 25rpx;\n        color: #fff;\n        @include background_color();\n        border-radius: 60rpx;\n    }\n}\n</style>\n","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./service.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./service.vue?vue&type=style&index=0&lang=scss&\"","// extracted by mini-css-extract-plugin\nmodule.exports = {\"red_theme\":\"#FF2C3C\",\"orange_theme\":\"#f7971e\",\"pink_theme\":\"#fa444d\",\"gold_theme\":\"#e0a356\",\"blue_theme\":\"#2f80ed\",\"green_theme\":\"#2ec840\"};\n    if(module.hot) {\n      // 1734801144891\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":true});\n      module.hot.dispose(cssReload);\n      \n    }\n  "],"sourceRoot":""}