{"version":3,"sources":["webpack:////Users/lisicheng/project/lijian/uni_modules/c-3d-model/components/c-3d-model/c-3d-model.vue?baf5","webpack:////Users/lisicheng/project/lijian/uni_modules/c-3d-model/components/c-3d-model/c-3d-model.vue?cf22","webpack:////Users/lisicheng/project/lijian/uni_modules/c-3d-model/components/c-3d-model/c-3d-model.vue?f8f7","webpack:////Users/lisicheng/project/lijian/uni_modules/c-3d-model/components/c-3d-model/c-3d-model.vue?23de","uni-app:///uni_modules/c-3d-model/components/c-3d-model/c-3d-model.vue","webpack:////Users/lisicheng/project/lijian/uni_modules/c-3d-model/components/c-3d-model/c-3d-model.vue?18db","webpack:////Users/lisicheng/project/lijian/uni_modules/c-3d-model/components/c-3d-model/c-3d-model.vue?176e"],"names":["scene","renderer","controls","clock","mixer","animations","isReloadModel","model","ambientLight","THREEglobal","mycanvas","props","canvasId","type","width","default","height","decoderPath","src","environmentSrc","modelScale","modelRotate","modelPosition","autoPlay","autoRotate","isCenter","emits","data","fun","computed","myCanvasId","modelData","watch","methods","disposeScene","object","removeObjects","removeFromRenderer","call","name","args","console","THREE","camera","playAnimation","stopAnimation","getContext","uni","pixelRatio","in","select","fields","node","size","exec","res","resolve","canvas","init","platform","alpha","antialias","precision","logarithmicDepthBuffer","onWindowResize","animate","render","light","loadEnvironment","texture","deleteObject","group","obj","center","box3","loadModel","touchStart","touchMove","touchEnd","mounted","destroyed","beforeDestroy"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAqS;AACrS;AAC8D;AACL;AACsC;;;AAG/F;AACmN;AACnN,gBAAgB,iNAAU;AAC1B,EAAE,gFAAM;AACR,EAAE,mQAAM;AACR,EAAE,4QAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,uQAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAu1B,CAAgB,wyBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;ACsC32B;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;AA3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAWA;EAAAA;EAAAC;EAAAC;EAAAC;EAAAC;EAAAC;EAAAC;EACAC;EAAAC;EAAAC;EAAAC;AAAA,gBAEA;EACAC;IACAC;MACAC;IACA;IACAC;MACAD;MACAE;IACA;IACAC;MACAH;MACAE;IACA;IACAE;MAAA;MACAJ;MACAE;IACA;IACAG;MAAA;MACAL;IACA;IACAM;MAAA;MACAN;IACA;IACAL;MAAA;MACAK;MACAE;IACA;IACAK;MAAA;MACAP;MACAE;QAAA;MAAA;IACA;;IACAM;MAAA;MACAR;MACAE;QAAA;MAAA;IACA;;IACAO;MAAA;MACAT;MACAE;QAAA;MAAA;IACA;;IACAQ;MAAA;MACAV;MACAE;IACA;IACAS;MAAA;MACAX;MACAE;IACA;IACAU;MACAZ;MACAE;IACA;EACA;EACAW;EACAC;IACA;MACAC;IACA;EACA;EACAC;IACAC;MACA;QACA;MACA;QACA;MACA;IACA;IACAC;MACA;QACAD;QACAhB;QACAE;QACAC;QACAC;QACAC;QACAX;QACAY;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;IACA;EAEA;EACAO;IACAD;MAEA;IAEA;EACA;EACAE;IACA;IACAC;MACAlC;QACA;UACAmC;UACAA;QACA;QACA;UACAA;QACA;MACA;IACA;IACA;IACAC;MACApC;QACA;UACAmC;QACA;MACA;IACA;IACA;IACAE;MACApC;MACAA;MACAA;MACAA;MACAA;IACA;IACAqC;MACA;QACAC;QACAC;MACA;MAEA;QACA;QACA;UACAC;QACA;UACAA;QACA;UACArC;QACA;MACA;MACA;QACA;QACA;UACA;UACA;QACA;QACA;UACAJ;QACA;QACA;QACA;QACA0C;QACA1C;QACAC;QACAA;QACAA;QACAQ;;QAEAkC;QACA3C;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACA+B;MACA;MACA;IAEA;IACAG;MAAA;MACA;IACA;IACAC;MAAA;MACA;IACA;IAEAC;MAAA;MACA;QACA,4BAEAC;UADAC;QAEAD,0BACAE,UACAC,qCACAC;UACAC;UACAC;QACA,GACAC;UACA,YAGAC;YAFAzC;YACAE;UAEA;UACA;UACA;UACAwC;YACAC;YACA3C;YACAE;YACAgC;UACA;QACA;MACA;IACA;IACAU;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACApD;gBACA;gBAAA,IACAN;kBAAA;kBAAA;gBAAA;gBAAA;gBAAA,OAOA;cAAA;gBAAA;gBAJAyD;gBACA3C;gBACAE;gBACAgC;gBAEAW;gBACA;gBACAjB;gBACA;gBACAhC;;gBAEA;gBACAV;gBACA;gBACA2C;gBACAA;gBACA1C;kBACA2D;kBACAC;kBAAA;kBACAC;kBACAC;gBACA;;gBACA9D;gBACAA;gBACAA;gBACAA;gBACAA;gBACA;gBACAC;gBACAA;gBACA;gBACAA;gBACAA;gBACAA;gBACAA;gBACAA;gBACA;gBACA;gBACA;gBAAA;gBAAA;cAAA;gBAGA;cAAA;gBAEAC;gBACA;kBACAD;gBACA;gBACA;AACA;AACA;gBACA;gBACA;gBACA;gBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IACA8D;MACArB;MACAA;MACA1C;IACA;IACAgE;MACA;MACA;MAEA/D;;MAEA;IACA;IACAgE;MACAjE;IACA;IACAkE;MACA;MACA;MACA;QACA;UACA3D;QACA;UACAA;UACAR;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;MACA;IAEA;IACAoE;MACA;MACA;QACA;QACA;UACAC;UACArE;UACAA;QACA;MACA;IACA;IACAsE;MACA;MACAC;QACA;UACAC;UACAA;QACA;MACA;MACA;MACAxE;IACA;IACAyE;MACA;AACA;AACA;MACA;MACA;MACA;MACAC;MACA;MACA;MACAA;MACA;;MAEA;MACAH;MACAA;MACAA;IACA;IACAI;MAAA;MACA;MACA;QACA;QACA,kHACAhD;UAAA;UACApB;UACA;UACAA;UACAA;UACAA;UACAoB;UACAvB;UACA;YACAC;YACA;YACA;YACA;UACA;;UACAL;UACA;QACA;MACA;QAAA;QACA;QACAO;QACAA;QACAA;QACA;MACA;IAEA;IACAqE;MACA;IACA;IACAC;MACA;IACA;IACAC;MACA;IACA;EASA;EACAC;IAEA;EAEA;EACAC,iCACA;EACAC;IACA;EACA;AACA;AAAA,4B;;;;;;;;;;;;;AC3dA;AAAA;AAAA;AAAA;AAA0lD,CAAgB,+7CAAG,EAAC,C;;;;;;;;;;;ACA9mD;AACA,OAAO,KAAU,EAAE,kBAKd","file":"uni_modules/c-3d-model/components/c-3d-model/c-3d-model.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./c-3d-model.vue?vue&type=template&id=332b43d9&scoped=true&filter-modules=eyJ0aHJlZSI6eyJ0eXBlIjoicmVuZGVyanMiLCJjb250ZW50IjoiIiwic3RhcnQiOjEzMzQ4LCJhdHRycyI6eyJtb2R1bGUiOiJ0aHJlZSIsImxhbmciOiJqcyJ9LCJlbmQiOjEzNDM1fX0%3D&\"\nvar renderjs\nimport script from \"./c-3d-model.vue?vue&type=script&lang=js&\"\nexport * from \"./c-3d-model.vue?vue&type=script&lang=js&\"\nimport style0 from \"./c-3d-model.vue?vue&type=style&index=0&id=332b43d9&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"332b43d9\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"uni_modules/c-3d-model/components/c-3d-model/c-3d-model.vue\"\nexport default component.exports","export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./c-3d-model.vue?vue&type=template&id=332b43d9&scoped=true&filter-modules=eyJ0aHJlZSI6eyJ0eXBlIjoicmVuZGVyanMiLCJjb250ZW50IjoiIiwic3RhcnQiOjEzMzQ4LCJhdHRycyI6eyJtb2R1bGUiOiJ0aHJlZSIsImxhbmciOiJqcyJ9LCJlbmQiOjEzNDM1fX0%3D&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./c-3d-model.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./c-3d-model.vue?vue&type=script&lang=js&\"","<template>\r\n\t<!-- #ifdef H5||APP-PLUS -->\r\n\t<view class=\"c-3d-model\"  :style=\"{width,height}\"  :modelData=\"modelData\" :change:modelData=\"three.init\" :fun='fun'\r\n\t\t:change:fun='three.callPlayer'>\r\n\t\t<div :id='myCanvasId'></div>\r\n\t</view>\r\n\t<!-- #endif -->\r\n\t<!-- #ifdef MP -->\r\n\t<!-- <demo :width=\"750\" :height=\"1000\" :style=\"{width,height}\"></demo> -->\r\n\t<view class=\"c-3d-model\"  :style=\"{width,height}\" >\r\n\t\t<canvas class=\"canvas\" :id=\"myCanvasId\" type=\"webgl\" \r\n\t\tdisable-scroll=\"true\"\n\t\t\t@touchstart=\"touchStart\" \n\t\t\t@touchmove=\"touchMove\" \n\t\t\t@touchend=\"touchEnd\"></canvas>\r\n\t</view>\r\n\t<!-- #endif -->\r\n</template>\r\n<script>\r\n\t/**\r\n\t * c-3d-model 3d模型预览组件\r\n\t * @description 用于3d模型预览 工业配件展示\r\n\t * @property {String} canvasId 画布id\r\n\t * @property {String} width 图像宽度 默认750rpx 单位rpx/px\r\n\t * @property {String} height 图像高度 默认750rpx 单位rpx/px\r\n\t * @property {String} src 模型地址 小程序只支持网络地址\n\t * @property {String} decoderPath DRACO解码器目录地址 APP|H5推荐使用线上地址 小程序小程序暂不支持DRACO\r\n\t * @property {String} environmentSrc 环境贴图地址\n\t * @property {Number} ambientLight 环境光强度0-1 默认0.5\n\t * @property {Array} modelScale 缩放模型 默认[1, 1, 1]\n\t * @property {Array} modelRotate 旋转模型 默认[0, 0, 0]\n\t * @property {Array} modelPosition 模型位置 默认[0, 0, 0]\n\t * @property {Boolean} autoPlay 是否自动播放模型中的第一组剪辑动画 默认true\r\n\t * @property {Boolean} autoRotate 场景是否自动旋转\r\n\t * @property {Boolean} isCenter 是否通过包围盒自动计算使模型居中 默认false 为true时modelPosition参数失效\r\n\t * @event {Function()} loaded 监听模型加载完成\r\n\t * 组件内方法统一使用 call(funName, args) 调用组件方法 详见文档\r\n\t * */\r\n\timport uuid from './js/uuid.js'\r\n\t// #ifdef MP\n\r\n\timport * as THREE from 'three-platformize';\r\n\timport { WechatPlatform } from 'three-platformize/src/WechatPlatform';\r\n\timport { RGBELoader } from 'three-platformize/examples/jsm/loaders/RGBELoader.js';\r\n\timport { GLTFLoader } from 'three-platformize/examples/jsm/loaders/GLTFLoader.js';\r\n\timport {OrbitControls} from 'three-platformize/examples/jsm/controls/OrbitControls.js'\r\n\timport {DRACOLoader} from 'three-platformize/examples/jsm/loaders/DRACOLoader.js'\r\n\r\n\tlet camera, scene, renderer, controls, clock, mixer, animations, isReloadModel = false,\r\n\t\tmodel, ambientLight, THREEglobal,mycanvas;\r\n\t// #endif\r\n\texport default {\r\n\t\tprops: {\r\n\t\t\tcanvasId: {\r\n\t\t\t\ttype: String\r\n\t\t\t},\r\n\t\t\twidth: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: '750rpx'\r\n\t\t\t},\r\n\t\t\theight: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: '750rpx'\r\n\t\t\t},\r\n\t\t\tdecoderPath: { //DRACO解码器目录地址 APP|H5推荐使用线上地址 小程序小程序暂不支持DRACO\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: ''\r\n\t\t\t},\r\n\t\t\tsrc: { //模型地址\r\n\t\t\t\ttype: String,\r\n\t\t\t},\r\n\t\t\tenvironmentSrc: { //环境贴图地址\r\n\t\t\t\ttype: String,\r\n\t\t\t},\r\n\t\t\tambientLight: { //环境光强度 0-1\r\n\t\t\t\ttype: Number,\r\n\t\t\t\tdefault: 0.5\r\n\t\t\t},\r\n\t\t\tmodelScale: { //缩放模型\r\n\t\t\t\ttype: Array,\r\n\t\t\t\tdefault:()=> [1, 1, 1] //x,y,z\r\n\t\t\t},\r\n\t\t\tmodelRotate: { //旋转模型\r\n\t\t\t\ttype: Array,\r\n\t\t\t\tdefault:()=>  [0, 0, 0] //x,y,z\r\n\t\t\t},\r\n\t\t\tmodelPosition: { //模型位置\r\n\t\t\t\ttype: Array,\r\n\t\t\t\tdefault:()=> [0, 0, 0] //x,y,z\r\n\t\t\t},\r\n\t\t\tautoPlay: { //是否自动播放模型中的第一组剪辑动画\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: true\r\n\t\t\t},\r\n\t\t\tautoRotate: { //场景是否自动旋转\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: false\r\n\t\t\t},\r\n\t\t\tisCenter:{\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: false\r\n\t\t\t}\r\n\t\t},\r\n\t\temits: ['loaded'],\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tfun: {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\tmyCanvasId() {\r\n\t\t\t\tif (!this.canvasId) {\r\n\t\t\t\t\treturn 'c' + uuid(18)\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn this.canvasId\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmodelData() {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tmyCanvasId: this.myCanvasId,\r\n\t\t\t\t\twidth: this.width,\r\n\t\t\t\t\theight: this.height,\r\n\t\t\t\t\tdecoderPath: this.decoderPath,\r\n\t\t\t\t\tsrc: this.src,\r\n\t\t\t\t\tenvironmentSrc: this.environmentSrc,\r\n\t\t\t\t\tambientLight: this.ambientLight,\r\n\t\t\t\t\tmodelScale: this.modelScale,\r\n\t\t\t\t\tmodelRotate: this.modelRotate,\r\n\t\t\t\t\tmodelPosition: this.modelPosition,\r\n\t\t\t\t\tautoPlay: this.autoPlay,\r\n\t\t\t\t\tautoRotate: this.autoRotate,\r\n\t\t\t\t\tisCenter:this.isCenter\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\tmodelData() {\r\n\t\t\t\t// #ifdef MP\r\n\t\t\t\tthis.init()\r\n\t\t\t\t// #endif\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t//释放资源\r\n\t\t\tdisposeScene(scene) {\r\n\t\t\t    scene.traverse(function(object) {\r\n\t\t\t        if (object instanceof THREE.Mesh) {\r\n\t\t\t            object.geometry.dispose();\r\n\t\t\t            object.material.dispose();\r\n\t\t\t        }\r\n\t\t\t        if (object instanceof THREE.Texture) {\r\n\t\t\t            object.dispose();\r\n\t\t\t        }\r\n\t\t\t    });\r\n\t\t\t},\r\n\t\t\t//移除场景对象\r\n\t\t\tremoveObjects(scene) {\r\n\t\t\t    scene.traverse(function(object) {\r\n\t\t\t        if (object.parent) {\r\n\t\t\t            object.parent.remove(object);\r\n\t\t\t        }\r\n\t\t\t    });\r\n\t\t\t},\r\n\t\t\t//从渲染器中移除\r\n\t\t\tremoveFromRenderer(renderer, scene) {\r\n\t\t\t    renderer.renderLists.dispose();\r\n\t\t\t    renderer.renderLists.freeMemory();\r\n\t\t\t    renderer.render(scene, null, 0);\r\n\t\t\t    renderer.renderLists.init();\r\n\t\t\t    renderer.renderLists.push(scene, null, 0);\r\n\t\t\t},\r\n\t\t\tcall(name, args) {\r\n\t\t\t\tthis.fun = {\r\n\t\t\t\t\tname,\r\n\t\t\t\t\targs\r\n\t\t\t\t}\r\n\t\t\t\t// #ifdef MP\n\t\t\t\tif (name == 'play' || name == 'stop') {\n\t\t\t\t\tconst length = animations.length\n\t\t\t\t\tif (length == 0) {\n\t\t\t\t\t\tconsole.error('模型文件中无剪辑动画');\n\t\t\t\t\t} else if (args > length) {\n\t\t\t\t\t\tconsole.error('模型文件中无该剪辑动画，动画组数：', length);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmixer.clipAction(animations[args])[name]()\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(name=='dispose'){\r\n\t\t\t\t\tif (model) this.deleteObject(model)\r\n\t\t\t\t\tif(scene){\r\n\t\t\t\t\t\tthis.disposeScene(scene)\r\n\t\t\t\t\t\tthis.removeObjects(scene)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor (let i = scene.children.length - 1; i >= 0; i--) {\r\n\t\t\t\t\t    scene.remove(scene.children[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// let gl = renderer.domElement.getContext(\"webgl\");\r\n\t\t\t\t\t// gl && gl.getExtension(\"WEBGL_lose_context\").loseContext();\r\n\t\t\t\t\tTHREE.PLATFORM.dispose();\n\t\t\t\t\tscene.clear();\n\t\t\t\t\trenderer.dispose();\n\t\t\t\t\trenderer.forceContextLoss();\n\t\t\t\t\trenderer.content = null;\n\t\t\t\t\tTHREEglobal.cancelAnimationFrame(this.animationID) // 去除animationFrame\n\t\t\t\t\t\n\t\t\t\t\tcamera=null\r\n\t\t\t\t\tscene=null\r\n\t\t\t\t\trenderer=null\r\n\t\t\t\t\tcontrols=null\r\n\t\t\t\t\tclock=null \r\n\t\t\t\t\tmixer=null\r\n\t\t\t\t\tanimations=null\r\n\t\t\t\t\tisReloadModel = false\r\n\t\t\t\t\tmodel=null \r\n\t\t\t\t\tambientLight=null \r\n\t\t\t\t\tTHREEglobal=null\r\n\t\t\t\t\tmycanvas=null\n\t\t\t\t\tconsole.log('场景销毁');\n\t\t\t\t}\r\n\t\t\t\t// this.callPlayer(fun.value)\r\n\t\t\t\t// #endif\r\n\t\t\t},\r\n\t\t\tplayAnimation(i = 0) {\r\n\t\t\t\tthis.call('play', i)\r\n\t\t\t},\r\n\t\t\tstopAnimation(i = 0) {\r\n\t\t\t\tthis.call('stop', i)\r\n\t\t\t},\r\n\t\t\t// #ifdef MP\r\n\t\t\tgetContext() {\r\n\t\t\t\treturn new Promise((resolve) => {\r\n\t\t\t\t\tconst {\r\n\t\t\t\t\t\tpixelRatio\r\n\t\t\t\t\t} = uni.getSystemInfoSync()\r\n\t\t\t\t\tuni.createSelectorQuery()\r\n\t\t\t\t\t\t.in(this)\r\n\t\t\t\t\t\t.select(`#${this.myCanvasId}`)\r\n\t\t\t\t\t\t.fields({\r\n\t\t\t\t\t\t\tnode: true,\r\n\t\t\t\t\t\t\tsize: true\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.exec(res => {\r\n\t\t\t\t\t\t\tconst {\r\n\t\t\t\t\t\t\t\twidth,\r\n\t\t\t\t\t\t\t\theight\r\n\t\t\t\t\t\t\t} = res[0]\r\n\t\t\t\t\t\t\tconst canvas = res[0].node\n\t\t\t\t\t\t\t// canvas.width = res[0].width\n\t\t\t\t\t\t\t// canvas.height = res[0].height\n\t\t\t\t\t\t\tresolve({\r\n\t\t\t\t\t\t\t\tcanvas,\r\n\t\t\t\t\t\t\t\twidth,\r\n\t\t\t\t\t\t\t\theight,\r\n\t\t\t\t\t\t\t\tpixelRatio\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tasync init() {\r\n\t\t\t\tisReloadModel = this.oldSrc != this.src || !model\n\t\t\t\tthis.oldSrc = this.src\r\n\t\t\t\tif (!scene) {\n\t\t\t\t\t// console.log('init');\r\n\t\t\t\t\tlet {\r\n\t\t\t\t\t\tcanvas,\r\n\t\t\t\t\t\twidth,\r\n\t\t\t\t\t\theight,\r\n\t\t\t\t\t\tpixelRatio\r\n\t\t\t\t\t} = await this.getContext()\n\t\t\t\t\tconst platform = new WechatPlatform(canvas); // webgl canvas\n\t\t\t\t\t// platform.enableDeviceOrientation('game'); // 开启DeviceOrientation\r\n\t\t\t\t\tTHREE.PLATFORM.set(platform);\n\t\t\t\t\tthis.platform = platform;\n\t\t\t\t\tmycanvas = THREEglobal = canvas\n\r\n\t\t\t\t\t// \t//setTimeout(()=>{//让步主线程\r\n\t\t\t\t\tscene = new THREE.Scene();\r\n\t\t\t\t\t//相机\r\n\t\t\t\t\tcamera = new THREE.PerspectiveCamera(45, width / height, 0.25, 20);\r\n\t\t\t\t\tcamera.position.set(0, 0.4, 0.7);\r\n\t\t\t\t\trenderer = new THREE.WebGLRenderer({\r\n\t\t\t\t\t\talpha: true,\r\n\t\t\t\t\t\tantialias: true, // 抗锯齿\r\n\t\t\t\t\t\tprecision: 'highp',\r\n\t\t\t\t\t\tlogarithmicDepthBuffer: false, //深度缓冲\r\n\t\t\t\t\t});\r\n\t\t\t\t\trenderer.setPixelRatio(pixelRatio*0.5);\r\n\t\t\t\t\trenderer.setSize(width, height);\r\n\t\t\t\t\trenderer.toneMapping = THREE.ACESFilmicToneMapping;\r\n\t\t\t\t\trenderer.toneMappingExposure = 1;\r\n\t\t\t\t\trenderer.outputEncoding = THREE.sRGBEncoding;\r\n\t\t\t\t\t//控制器\r\n\t\t\t\t\tcontrols = new OrbitControls(camera, renderer.domElement);\r\n\t\t\t\t\tcontrols.enableDamping = true;\r\n\t\t\t\t\t// controls.enabled = false\r\n\t\t\t\t\tcontrols.minDistance = 0.1;\r\n\t\t\t\t\tcontrols.maxDistance = 1;\r\n\t\t\t\t\tcontrols.autoRotate = this.autoRotate; //场景自动旋转\r\n\t\t\t\t\tcontrols.target.set(0, 0.1, 0);\r\n\t\t\t\t\tcontrols.update();\n\t\t\t\t\tthis.onWindowResize()\r\n\t\t\t\t\tthis.animate();\r\n\t\t\t\t\t// \t//},20)\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.onWindowResize()\r\n\t\t\t\t}\r\n\t\t\t\tclock = new THREE.Clock();\r\n\t\t\t\tif (controls) {\r\n\t\t\t\t\tcontrols.autoRotate = this.autoRotate; //场景自动旋转\r\n\t\t\t\t}\r\n\t\t\t\t/*\r\n\t\t\t\t\t光源设置\r\n\t\t\t\t */\r\n\t\t\t\tthis.light()\r\n\t\t\t\t//环境\r\n\t\t\t\tthis.loadEnvironment()\r\n\t\t\t\t// model\r\n\t\t\t\tthis.loadModel()\r\n\t\t\t},\r\n\t\t\tonWindowResize() {\n\t\t\t\tcamera.aspect = parseInt(this.width) / parseInt(this.height);\r\n\t\t\t\tcamera.updateProjectionMatrix();\r\n\t\t\t\trenderer.setSize( parseInt(this.width),parseInt(this.height));\r\n\t\t\t},\r\n\t\t\tanimate() {\n\t\t\t\tthis.animationID=THREEglobal.requestAnimationFrame(this.animate)\r\n\t\t\t\tif (mixer) mixer.update(clock.getDelta());\r\n\r\n\t\t\t\tcontrols.update(); // required if damping enabled\r\n\r\n\t\t\t\tthis.render();\r\n\t\t\t},\r\n\t\t\trender() {\r\n\t\t\t\trenderer.render(scene, camera);\r\n\t\t\t},\r\n\t\t\tlight() {\r\n\t\t\t\tlet data = this.modelData\r\n\t\t\t\t// 环境光\r\n\t\t\t\tif (data.ambientLight) {\r\n\t\t\t\t\tif (ambientLight) {\r\n\t\t\t\t\t\tambientLight.intensity = data.ambientLight //环境光的强度\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tambientLight = new THREE.AmbientLight(0xffffff, data.ambientLight);\r\n\t\t\t\t\t\tscene.add(ambientLight);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t//点光源\r\n\t\t\t\t// const point = new THREE.PointLight(0xffffff,1);\r\n\t\t\t\t// point.position.set( 0, 0.4, 0.7 ); //点光源位置\r\n\t\t\t\t// scene.add(point); //点光源添加到场景中\r\n\t\t\t\t// const point2 = new THREE.PointLight(0xffffff,1);\r\n\t\t\t\t// point2.position.set(5,5,-200 ); //点光源位置\r\n\t\t\t\t// scene.add(point2); //点光源添加到场景中\r\n\t\t\t\t// 半球光\r\n\t\t\t\t// const hemiLight = new THREE.HemisphereLight();\r\n\t\t\t\t// hemiLight.intensity = 0.8\r\n\t\t\t\t// scene.add( hemiLight );\r\n\t\t\t\t\r\n\t\t\t\t//平行光\r\n\t\t\t\t// const light = new THREE.DirectionalLight( 0xffffff,0.2);\r\n\t\t\t\t// light.position.set(-50,10,-100);\r\n\t\t\t\t// scene.add( light );\r\n\t\t\t\t// const light2 = new THREE.DirectionalLight( 0xffffff,0.2);\r\n\t\t\t\t// light2.position.set(50,10,100);\r\n\t\t\t\t// scene.add( light2 );\r\n\t\t\t\t// const light3 = new THREE.DirectionalLight( 0xffffff,1);\r\n\t\t\t\t// light3.position.set(0,0,100);\r\n\t\t\t\t// scene.add( light3 );\r\n\t\t\t\t// const light4 = new THREE.DirectionalLight( 0xffffff,0.8);\r\n\t\t\t\t// light4.position.set(0,0,-50);\r\n\t\t\t\t// scene.add( light4 );\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t},\r\n\t\t\tloadEnvironment() {\r\n\t\t\t\tlet data = this.modelData\r\n\t\t\t\tif (data.environmentSrc) {\r\n\t\t\t\t\t// .setDataType(THREE.UnsignedByteType)\r\n\t\t\t\t\tnew RGBELoader().load(data.environmentSrc, (texture) => {\r\n\t\t\t\t\t\ttexture.mapping = THREE.EquirectangularReflectionMapping;\r\n\t\t\t\t\t\tscene.background = texture;\r\n\t\t\t\t\t\tscene.environment = texture;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\n\t\t\tdeleteObject(group) {\n\t\t\t\t// 递归遍历组对象group释放所有后代网格模型绑定几何体占用内存\n\t\t\t\tgroup.traverse(function(obj) {\n\t\t\t\t\tif (obj.type === 'Mesh') {\n\t\t\t\t\t\tobj.geometry.dispose();\n\t\t\t\t\t\tobj.material.dispose();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t// 删除场景对象scene的子对象group\n\t\t\t\tscene.remove(group);\n\t\t\t},\r\n\t\t\tcenter(group) {\r\n\t\t\t\t/**\r\n\t\t\t\t * 包围盒全自动计算：模型整体居中\r\n\t\t\t\t */\r\n\t\t\t\tlet box3 = new THREE.Box3()\r\n\t\t\t\t// 计算层级模型group的包围盒\r\n\t\t\t\t// 模型group是加载一个三维模型返回的对象，包含多个网格模型\r\n\t\t\t\tbox3.expandByObject(group)\r\n\t\t\t\t// 计算一个层级模型对应包围盒的几何体中心在世界坐标中的位置\r\n\t\t\t\tlet center = new THREE.Vector3()\r\n\t\t\t\tbox3.getCenter(center)\r\n\t\t\t\t// console.log('查看几何体中心坐标', center);\r\n\t\t\t\r\n\t\t\t\t// 重新设置模型的位置，使之居中。\r\n\t\t\t\tgroup.position.x = group.position.x - center.x\r\n\t\t\t\tgroup.position.y = group.position.y - center.y\r\n\t\t\t\tgroup.position.z = group.position.z - center.z\r\n\t\t\t},\r\n\t\t\tloadModel() {\r\n\t\t\t\tlet data = this.modelData\n\t\t\t\tif (isReloadModel) {\r\n\t\t\t\t\tif (model) this.deleteObject(model)\n\t\t\t\t\tnew GLTFLoader().setDRACOLoader(new DRACOLoader().setDecoderPath(data.decoderPath)).load(\r\n\t\t\t\t\t\tdata.src, (gltf) => {\r\n\t\t\t\t\t\t\tmodel = gltf.scene\r\n\t\t\t\t\t\t\tmodel.scale.set(...data.modelScale)\r\n\t\t\t\t\t\t\tmodel.rotateX(data.modelRotate[0])\r\n\t\t\t\t\t\t\tmodel.rotateY(data.modelRotate[1])\r\n\t\t\t\t\t\t\tmodel.rotateZ(data.modelRotate[2])\r\n\t\t\t\t\t\t\tdata.isCenter?this.center(model):model.position.set(...data.modelPosition)\r\n\t\t\t\t\t\t\tmixer = new THREE.AnimationMixer(model);\r\n\t\t\t\t\t\t\tif (data.autoPlay) {\r\n\t\t\t\t\t\t\t\tanimations = gltf.animations\r\n\t\t\t\t\t\t\t\t// for (let s of gltf.animations) {\r\n\t\t\t\t\t\t\t\tif (animations.length > 0) mixer.clipAction(animations[0]).play();\r\n\t\t\t\t\t\t\t\t// }\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tscene.add(model);\r\n\t\t\t\t\t\t\tthis.$emit('loaded')\r\n\t\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmodel.scale.set(...data.modelScale)\r\n\t\t\t\t\tmodel.rotateX(data.modelRotate[0])\r\n\t\t\t\t\tmodel.rotateY(data.modelRotate[1])\r\n\t\t\t\t\tmodel.rotateZ(data.modelRotate[2])\r\n\t\t\t\t\tmodel.position.set(...data.modelPosition)\r\n\t\t\t\t}\r\n\r\n\t\t\t},\n\t\t\ttouchStart(e) {\n\t\t\t\tthis.platform.dispatchTouchEvent(e);\n\t\t\t},\n\t\t\ttouchMove(e) {\n\t\t\t\tthis.platform.dispatchTouchEvent(e);\n\t\t\t},\n\t\t\ttouchEnd(e) {\n\t\t\t\tthis.platform.dispatchTouchEvent(e);\n\t\t\t}\r\n\t\t\t// #endif\r\n\t\t\t// #ifndef MP\r\n\t\t\treceiveRenderData(val) {\r\n\t\t\t\t// console.log(val);\r\n\t\t\t\tthis.$emit(val.name, val.val)\r\n\t\t\t},\r\n\t\t\t// #endif\n\t\t\t\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\t// #ifdef MP\r\n\t\t\tthis.init()\r\n\t\t\t// #endif\r\n\t\t},\r\n\t\tdestroyed() {\n\t\t},\n\t\tbeforeDestroy() {\n\t\t\tthis.call('dispose')\n\t\t}\r\n\t}\r\n</script>\r\n<!-- #ifndef MP -->\r\n\n<!-- #ifdef VUE3 -->\n<script src='./js/render.js' module=\"three\" lang=\"renderjs\"></script>\n<!-- #endif -->\n\n<!-- #ifdef VUE2 -->\n<script module=\"three\" lang=\"renderjs\">\n\timport threeRender from \"./js/render.js\"\n\texport default {\n\t\tmixins:[threeRender]\n\t}\n</script>\n<!-- #endif -->\n\r\n<!-- #endif -->\r\n\r\n<style lang=\"scss\" scoped>\r\n\t.c-3d-model {\r\n\t\t// width: v-bind(width);\r\n\t\t// height: v-bind(height);\r\n\r\n\t\t/* #ifndef MP */\r\n\t\tdiv {\r\n\t\t\twidth: 100%;\r\n\t\t\theight: 100%;\r\n\t\t}\r\n\r\n\t\t/* #endif */\r\n\r\n\t\t.canvas {\r\n\t\t\twidth: 100%;\r\n\t\t\theight: 100%;\r\n\t\t}\r\n\t}\r\n</style>","import mod from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./c-3d-model.vue?vue&type=style&index=0&id=332b43d9&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./c-3d-model.vue?vue&type=style&index=0&id=332b43d9&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1734802321372\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}